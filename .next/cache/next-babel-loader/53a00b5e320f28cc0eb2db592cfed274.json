{"ast":null,"code":"const path = require('path');\n\nrequire('dotenv').config({\n  path: path.join(__dirname, '../.env')\n});\n\nconst nodemailer = require('nodemailer');\n\nconst nodeMailerPass = process.env.nodeMailerPass;\nconst nodeMailerUser = process.env.nodeMailerUser;\nconst transporter = nodemailer.createTransport({\n  host: 'smtp.zoho.eu',\n  port: 465,\n  secure: true,\n  //ssl\n  auth: {\n    user: nodeMailerUser,\n    pass: nodeMailerPass\n  }\n}); // // send contact form submitted\n\nasync function sendContactForm(name, email, subject, phone, message) {\n  const date = dayjs().format('MMM Do YYYY');\n  let mailOptions = {\n    from: nodeMailerUser,\n    // sender address (who sends)\n    // from: { // from using address object\n    //     name: 'Greenscapes Gardening',\n    //     address: nodeMailerUser\n    // },\n    to: email,\n    // list of receivers (who receives)\n    cc: nodeMailerUser,\n    subject: `We have received your enquiry`,\n    // Subject line\n    replyTo: email,\n    html: `<b>${date}</b> <p>Email: ${email}</p> <p>Name: ${name}</p> <p>Phone: ${phone}</p> <p>Message: ${message}</p>` // html body\n\n  };\n  return transporter.sendMail(mailOptions).then(email => {\n    console.log('here', email);\n    if (email.rejected.length > 0) throw {\n      status: 404,\n      message: 'Rejected'\n    };\n    return res.status(201).send({\n      success: true,\n      msg: 'Enquiry submitted'\n    });\n  }).catch(err => {\n    console.log('err1', err);\n    if (err.status === 404) return next(err);else return next({\n      status: 500,\n      message: 'server error'\n    });\n  });\n}\n\nmodule.exports = {\n  sendContactForm\n};","map":{"version":3,"sources":["/Users/user1/Documents/development/greenscapes/greenscapes-domestic/utils/nodemailer.js"],"names":["path","require","config","join","__dirname","nodemailer","nodeMailerPass","process","env","nodeMailerUser","transporter","createTransport","host","port","secure","auth","user","pass","sendContactForm","name","email","subject","phone","message","date","dayjs","format","mailOptions","from","to","cc","replyTo","html","sendMail","then","console","log","rejected","length","status","res","send","success","msg","catch","err","next","module","exports"],"mappings":"AAAA,MAAMA,IAAI,GAAGC,OAAO,CAAC,MAAD,CAApB;;AACAA,OAAO,CAAC,QAAD,CAAP,CAAkBC,MAAlB,CAAyB;AAACF,EAAAA,IAAI,EAAEA,IAAI,CAACG,IAAL,CAAUC,SAAV,EAAqB,SAArB;AAAP,CAAzB;;AAEA,MAAMC,UAAU,GAAGJ,OAAO,CAAC,YAAD,CAA1B;;AACA,MAAMK,cAAc,GAAGC,OAAO,CAACC,GAAR,CAAYF,cAAnC;AACA,MAAMG,cAAc,GAAGF,OAAO,CAACC,GAAR,CAAYC,cAAnC;AAEA,MAAMC,WAAW,GAAGL,UAAU,CAACM,eAAX,CAA2B;AAC3CC,EAAAA,IAAI,EAAE,cADqC;AAE3CC,EAAAA,IAAI,EAAE,GAFqC;AAG3CC,EAAAA,MAAM,EAAE,IAHmC;AAG7B;AACdC,EAAAA,IAAI,EAAE;AACFC,IAAAA,IAAI,EAAEP,cADJ;AAEFQ,IAAAA,IAAI,EAAEX;AAFJ;AAJqC,CAA3B,CAApB,C,CAUA;;AACA,eAAeY,eAAf,CAAgCC,IAAhC,EAAsCC,KAAtC,EAA6CC,OAA7C,EAAsDC,KAAtD,EAA6DC,OAA7D,EAAsE;AAClE,QAAMC,IAAI,GAAGC,KAAK,GAAGC,MAAR,CAAe,aAAf,CAAb;AAEA,MAAIC,WAAW,GAAG;AACdC,IAAAA,IAAI,EAAEnB,cADQ;AACQ;AACtB;AACA;AACA;AACA;AACAoB,IAAAA,EAAE,EAAET,KANU;AAMH;AACXU,IAAAA,EAAE,EAAErB,cAPU;AAQdY,IAAAA,OAAO,EAAG,+BARI;AAQ4B;AAC1CU,IAAAA,OAAO,EAAEX,KATK;AAUdY,IAAAA,IAAI,EAAG,MAAKR,IAAK,kBAAiBJ,KAAM,iBAAgBD,IAAK,kBAAiBG,KAAM,oBAAmBC,OAAQ,MAVjG,CAUuG;;AAVvG,GAAlB;AAaA,SAAOb,WAAW,CAACuB,QAAZ,CAAqBN,WAArB,EACNO,IADM,CACAd,KAAD,IAAW;AACbe,IAAAA,OAAO,CAACC,GAAR,CAAY,MAAZ,EAAmBhB,KAAnB;AACA,QAAIA,KAAK,CAACiB,QAAN,CAAeC,MAAf,GAAwB,CAA5B,EAA+B,MAAM;AAACC,MAAAA,MAAM,EAAE,GAAT;AAAchB,MAAAA,OAAO,EAAE;AAAvB,KAAN;AAC/B,WAAOiB,GAAG,CAACD,MAAJ,CAAW,GAAX,EAAgBE,IAAhB,CAAqB;AAACC,MAAAA,OAAO,EAAE,IAAV;AAAgBC,MAAAA,GAAG,EAAE;AAArB,KAArB,CAAP;AACH,GALM,EAMNC,KANM,CAMCC,GAAD,IAAS;AACZV,IAAAA,OAAO,CAACC,GAAR,CAAY,MAAZ,EAAoBS,GAApB;AACA,QAAIA,GAAG,CAACN,MAAJ,KAAe,GAAnB,EAAwB,OAAOO,IAAI,CAACD,GAAD,CAAX,CAAxB,KACK,OAAOC,IAAI,CAAC;AAACP,MAAAA,MAAM,EAAE,GAAT;AAAchB,MAAAA,OAAO,EAAE;AAAvB,KAAD,CAAX;AACR,GAVM,CAAP;AAWH;;AAGDwB,MAAM,CAACC,OAAP,GAAiB;AACb9B,EAAAA;AADa,CAAjB","sourcesContent":["const path = require('path');\nrequire('dotenv').config({path: path.join(__dirname, '../.env')});\n\nconst nodemailer = require('nodemailer');\nconst nodeMailerPass = process.env.nodeMailerPass;\nconst nodeMailerUser = process.env.nodeMailerUser;\n\nconst transporter = nodemailer.createTransport({\n    host: 'smtp.zoho.eu',\n    port: 465,\n    secure: true, //ssl\n    auth: {\n        user: nodeMailerUser,\n        pass: nodeMailerPass\n    }\n});\n\n// // send contact form submitted\nasync function sendContactForm (name, email, subject, phone, message) {\n    const date = dayjs().format('MMM Do YYYY');\n\n    let mailOptions = {\n        from: nodeMailerUser, // sender address (who sends)\n        // from: { // from using address object\n        //     name: 'Greenscapes Gardening',\n        //     address: nodeMailerUser\n        // },\n        to: email, // list of receivers (who receives)\n        cc: nodeMailerUser,\n        subject: `We have received your enquiry`, // Subject line\n        replyTo: email,\n        html: `<b>${date}</b> <p>Email: ${email}</p> <p>Name: ${name}</p> <p>Phone: ${phone}</p> <p>Message: ${message}</p>` // html body\n    };\n\n    return transporter.sendMail(mailOptions)\n    .then((email) => {\n        console.log('here',email)\n        if (email.rejected.length > 0) throw {status: 404, message: 'Rejected'};         \n        return res.status(201).send({success: true, msg: 'Enquiry submitted'});       \n    })\n    .catch((err) => {\n        console.log('err1', err)\n        if (err.status === 404) return next(err);\n        else return next({status: 500, message: 'server error'});\n    });\n}\n\n\nmodule.exports = {\n    sendContactForm,\n}"]},"metadata":{},"sourceType":"script"}