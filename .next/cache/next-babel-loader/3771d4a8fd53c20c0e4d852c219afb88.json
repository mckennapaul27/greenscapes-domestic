{"ast":null,"code":"const path = require('path');\n\nrequire('dotenv').config({\n  path: path.join(__dirname, '../.env')\n}); // const accountSid = process.env.TWILIO_ACCOUNT_SID;\n// const authToken = process.env.TWILIO_AUTH_TOKEN;\n// const twilio = require('twilio');\n// const clientCheck = twilio(accountSid, authToken).lookups.v1;\n\n\nconst SibApiV3Sdk = require('sib-api-v3-sdk');\n\nconst defaultClient = SibApiV3Sdk.ApiClient.instance; // const { getVipRequestText } = require('../utils/api.helpers')\n// const { Application, User } = require('../models/index');\n// const { AffPartner } = require('../models/affiliates/index')\n// const crypto = require('crypto');\n// const moment = require('moment');\n// const accounting = require('accounting'); \n// const startOfMonthToYesterday = () => moment().startOf('month').add(12, 'hours').format('DD/MM/YYYY') + ' - ' + moment().subtract(1, 'days').format('DD/MM/YYYY');\n// Configure API key authorization: api-key\n\nlet apiKey = defaultClient.authentications['api-key'];\napiKey.apiKey = process.env.SNDBLAPIKEY; // Configure API key authorization: partner-key\n\nlet partnerKey = defaultClient.authentications['partner-key'];\npartnerKey.apiKey = process.env.PARTNERSNDBLAPIKEY; // function to verify mobile number is correct\n\nfunction verify(phoneNumber) {\n  return clientCheck.phoneNumbers(phoneNumber).fetch().then(() => {\n    return true;\n  }).catch(() => {\n    return false;\n  });\n} // send welcome email\n\n\nfunction sendWelcomeEmail({\n  firstName,\n  email\n}) {\n  const apiInstance = new SibApiV3Sdk.SMTPApi();\n  let sendSmtpEmail = new SibApiV3Sdk.SendSmtpEmail();\n  sendSmtpEmail.sender = {\n    name: 'eWalletBooster',\n    email: 'support@ewalletbooster.com'\n  };\n  sendSmtpEmail.to = [{\n    email: email,\n    name: firstName\n  }];\n  sendSmtpEmail.replyTo = {\n    email: 'support@ewalletbooster.com'\n  };\n  sendSmtpEmail.templateId = 17;\n  sendSmtpEmail.tags = ['join'];\n  sendSmtpEmail.params = {\n    FNAME: firstName\n  };\n  apiInstance.sendTransacEmail(sendSmtpEmail).then(() => {\n    return {\n      success: true,\n      msg: 'Email sent'\n    };\n  }).catch(err => {\n    return err;\n  });\n} // send application submitted email regardless of whether belongsTo 'Account' as based on req.body data\n\n\nfunction sendApplicationSubmit({\n  firstName,\n  email,\n  brand,\n  accountId,\n  accountEmailAddress,\n  accountCurrency,\n  typeOfAccount\n}) {\n  const apiInstance = new SibApiV3Sdk.SMTPApi();\n  let sendSmtpEmail = new SibApiV3Sdk.SendSmtpEmail();\n  sendSmtpEmail.sender = {\n    name: 'eWalletBooster',\n    email: 'support@ewalletbooster.com'\n  };\n  sendSmtpEmail.to = [{\n    email: email,\n    name: firstName\n  }];\n  sendSmtpEmail.replyTo = {\n    email: 'support@ewalletbooster.com'\n  };\n  sendSmtpEmail.templateId = 1;\n  sendSmtpEmail.tags = ['application'];\n  sendSmtpEmail.params = {\n    FNAME: firstName,\n    EMAIL: accountEmailAddress,\n    ACCOUNTID: accountId,\n    BRAND: brand,\n    CURRENCY: accountCurrency,\n    STATUS: 'Pending',\n    TYPE: typeOfAccount\n  };\n  apiInstance.sendTransacEmail(sendSmtpEmail).then(() => {\n    return {\n      success: true,\n      msg: 'Email sent'\n    };\n  }).catch(err => {\n    return err;\n  });\n} // send application submitted SMS regardless of whether belongsTo 'Account' as based on req.body data\n\n\nfunction sendApplicationSubmitSMS({\n  firstName,\n  brand,\n  accountId,\n  mobileNumber\n}) {\n  if (verify(mobileNumber)) {\n    const apiInstance = new SibApiV3Sdk.TransactionalSMSApi();\n    let sendTransacSms = new SibApiV3Sdk.SendTransacSms();\n    sendTransacSms.sender = 'EWB';\n    sendTransacSms.recipient = mobileNumber;\n    sendTransacSms.content = `Hi ${firstName}. We have received your ${brand} application for ${accountId}. You will receive a response soon. Thanks, EWB.`;\n    sendTransacSms.type = 'transactional';\n    sendTransacSms.tag = 'application';\n    apiInstance.sendTransacSms(sendTransacSms).then(() => {\n      return {\n        success: true,\n        msg: 'SMS sent'\n      };\n    }).catch(err => {\n      return err;\n    });\n  } else return;\n} // send application result regardless of belongsTo using different templateId's\n\n\nfunction sendApplicationResult(_id, subJoinText) {\n  const apiInstance = new SibApiV3Sdk.SMTPApi();\n  let sendSmtpEmail = new SibApiV3Sdk.SendSmtpEmail();\n  const template = {\n    'approved': 2,\n    'approved and upgraded to VIP': 2,\n    'declined': 3,\n    'approved for cashback': 28,\n    'approved for cashback and upgraded to VIP': 28\n  };\n  sendSmtpEmail.sender = {\n    name: 'eWalletBooster',\n    email: 'support@ewalletbooster.com'\n  };\n  sendSmtpEmail.replyTo = {\n    email: 'support@ewalletbooster.com'\n  };\n  sendSmtpEmail.tags = ['application'];\n  Application.findById(_id).then(a => {\n    const vipStatus = getVipRequestText(subJoinText);\n    sendSmtpEmail.to = [{\n      email: a.accountEmailAddress,\n      name: a.firstName\n    }];\n\n    if (a.belongsTo) {\n      sendSmtpEmail.templateId = template[subJoinText];\n      sendSmtpEmail.params = {\n        FNAME: a.firstName,\n        EMAIL: a.accountEmailAddress,\n        ACCOUNTID: a.accountId,\n        BRAND: a.brand,\n        CURRENCY: a.accountCurrency,\n        SUBJOINTEXT: subJoinText,\n        VIPUPGRADETEXT: vipStatus\n      };\n      apiInstance.sendTransacEmail(sendSmtpEmail).then(() => {\n        return {\n          success: true,\n          msg: 'Email sent'\n        };\n      }).catch(err => {\n        return err;\n      });\n    } else {\n      Application.findById(a._id).then(application => {\n        Promise.all([application, crypto.randomBytes(20)]).then(([application, buffer]) => {\n          const token = buffer.toString('hex');\n          Application.findByIdAndUpdate(application._id, {\n            applicationToken: token,\n            applicationExpires: Date.now() + 86400000\n          }, {\n            upsert: true,\n            new: true\n          }).then(() => {\n            sendSmtpEmail.templateId = subJoinText === 'declined' ? 3 : 4;\n            sendSmtpEmail.params = {\n              FNAME: a.firstName,\n              EMAIL: a.accountEmailAddress,\n              ACCOUNTID: a.accountId,\n              BRAND: a.brand,\n              CURRENCY: a.accountCurrency,\n              SUBJOINTEXT: subJoinText,\n              VIPUPGRADETEXT: vipStatus,\n              ID: token\n            };\n            apiInstance.sendTransacEmail(sendSmtpEmail).then(() => {\n              return {\n                success: true,\n                msg: 'Email sent'\n              };\n            }).catch(err => {\n              return err;\n            });\n          }).catch(err => {\n            return err;\n          });\n        }).catch(err => {\n          return err;\n        });\n      }).catch(err => {\n        return err;\n      });\n    }\n  }).catch(err => {\n    return err;\n  });\n} // send application result sms text\n\n\nfunction sendApplicationResultSMS({\n  firstName,\n  brand,\n  accountId,\n  mobileNumber\n}, subJoinText) {\n  if (verify(mobileNumber)) {\n    const apiInstance = new SibApiV3Sdk.TransactionalSMSApi();\n    let sendTransacSms = new SibApiV3Sdk.SendTransacSms();\n    sendTransacSms.sender = 'EWB';\n    sendTransacSms.recipient = mobileNumber;\n    sendTransacSms.content = `Hi ${firstName}. Your ${brand} application for ${accountId} has been ${subJoinText}. Thanks, EWB.`;\n    sendTransacSms.type = 'transactional';\n    sendTransacSms.tag = 'application';\n    apiInstance.sendTransacSms(sendTransacSms).then(() => {\n      return {\n        success: true,\n        msg: 'SMS sent'\n      };\n    }).catch(err => {\n      return err;\n    });\n  } else return;\n} // send confirmation of application linked\n\n\nfunction sendApplicationLinked({\n  firstName,\n  brand,\n  accountId,\n  email\n}) {\n  const apiInstance = new SibApiV3Sdk.SMTPApi();\n  let sendSmtpEmail = new SibApiV3Sdk.SendSmtpEmail();\n  sendSmtpEmail.sender = {\n    name: 'eWalletBooster',\n    email: 'support@ewalletbooster.com'\n  };\n  sendSmtpEmail.to = [{\n    email: email,\n    name: firstName\n  }];\n  sendSmtpEmail.replyTo = {\n    email: 'support@ewalletbooster.com'\n  };\n  sendSmtpEmail.templateId = 6;\n  sendSmtpEmail.tags = ['application'];\n  sendSmtpEmail.params = {\n    FNAME: firstName,\n    ACCOUNTID: accountId,\n    BRAND: brand\n  };\n  apiInstance.sendTransacEmail(sendSmtpEmail).then(() => {\n    return {\n      success: true,\n      msg: 'Email sent'\n    };\n  }).catch(err => {\n    return err;\n  });\n} // send bonus start\n\n\nfunction sendBonusStart({\n  status,\n  value,\n  accountId,\n  brand\n}, email, firstName) {\n  const apiInstance = new SibApiV3Sdk.SMTPApi();\n  let sendSmtpEmail = new SibApiV3Sdk.SendSmtpEmail();\n  const currency = brand === 'ecoPayz' ? '€' : '$';\n  const bonusValue = currency + value;\n  const transRequirement = brand === 'Skrill' ? '$3,500' : brand === 'ecoPayz' ? '€5,000' : '$2,000';\n  sendSmtpEmail.sender = {\n    name: 'eWalletBooster',\n    email: 'support@ewalletbooster.com'\n  };\n  sendSmtpEmail.to = [{\n    email: email,\n    name: firstName\n  }];\n  sendSmtpEmail.replyTo = {\n    email: 'support@ewalletbooster.com'\n  };\n  sendSmtpEmail.templateId = 7;\n  sendSmtpEmail.tags = ['bonus'];\n  sendSmtpEmail.params = {\n    FNAME: firstName,\n    ACCOUNTID: accountId,\n    BRAND: brand,\n    STATUS: status,\n    VALUE: bonusValue,\n    REQUIREMENT: transRequirement\n  };\n  apiInstance.sendTransacEmail(sendSmtpEmail).then(() => {\n    return {\n      success: true,\n      msg: 'Email sent'\n    };\n  }).catch(err => {\n    return err;\n  });\n} // send bonus start for neteller 1% bonus\n\n\nfunction sendPercentBonusStart({\n  status,\n  accountId,\n  brand,\n  startDate,\n  endDate\n}, email, firstName) {\n  const apiInstance = new SibApiV3Sdk.SMTPApi();\n  let sendSmtpEmail = new SibApiV3Sdk.SendSmtpEmail();\n  const start = moment(startDate).format('DD/MM/YYYY');\n  const end = moment(endDate).format('DD/MM/YYYY');\n  sendSmtpEmail.sender = {\n    name: 'eWalletBooster',\n    email: 'support@ewalletbooster.com'\n  };\n  sendSmtpEmail.to = [{\n    email: email,\n    name: firstName\n  }];\n  sendSmtpEmail.replyTo = {\n    email: 'support@ewalletbooster.com'\n  };\n  sendSmtpEmail.templateId = 8;\n  sendSmtpEmail.tags = ['bonus'];\n  sendSmtpEmail.params = {\n    FNAME: firstName,\n    ACCOUNTID: accountId,\n    BRAND: brand,\n    STATUS: status,\n    START: start,\n    END: end\n  };\n  apiInstance.sendTransacEmail(sendSmtpEmail).then(() => {\n    return {\n      success: true,\n      msg: 'Email sent'\n    };\n  }).catch(err => {\n    return err;\n  });\n} // send confirmation bonus paid\n\n\nfunction sendBonusPayment({\n  value,\n  brand,\n  accountId\n}, {\n  firstName,\n  email\n}) {\n  const apiInstance = new SibApiV3Sdk.SMTPApi();\n  let sendSmtpEmail = new SibApiV3Sdk.SendSmtpEmail();\n  const currency = brand === 'ecoPayz' ? '€' : '$';\n  const bonusValue = currency + value.toFixed(2);\n  sendSmtpEmail.sender = {\n    name: 'eWalletBooster',\n    email: 'support@ewalletbooster.com'\n  };\n  sendSmtpEmail.to = [{\n    email: email,\n    name: firstName\n  }];\n  sendSmtpEmail.replyTo = {\n    email: 'support@ewalletbooster.com'\n  };\n  sendSmtpEmail.templateId = 10;\n  sendSmtpEmail.tags = ['bonus'];\n  sendSmtpEmail.params = {\n    FNAME: firstName,\n    ACCOUNTID: accountId,\n    BRAND: brand,\n    VALUE: bonusValue\n  };\n  apiInstance.sendTransacEmail(sendSmtpEmail).then(() => {\n    return {\n      success: true,\n      msg: 'Email sent'\n    };\n  }).catch(err => {\n    return err;\n  });\n} // send contact form submitted\n\n\nfunction sendMessage({\n  name,\n  email,\n  message\n}, date) {\n  const apiInstance = new SibApiV3Sdk.SMTPApi();\n  let sendSmtpEmail = new SibApiV3Sdk.SendSmtpEmail();\n  sendSmtpEmail.sender = {\n    name: 'eWalletBooster',\n    email: 'support@ewalletbooster.com'\n  };\n  sendSmtpEmail.to = [{\n    email: email,\n    name: name\n  }, {\n    name: 'eWalletBooster',\n    email: 'support@ewalletbooster.com'\n  }];\n  sendSmtpEmail.replyTo = {\n    email: email\n  };\n  sendSmtpEmail.templateId = 11;\n  sendSmtpEmail.tags = ['support'];\n  sendSmtpEmail.params = {\n    FNAME: name,\n    DATE: date,\n    MESSAGE: message,\n    EMAIL: email\n  };\n  apiInstance.sendTransacEmail(sendSmtpEmail).then(() => {\n    return {\n      success: true,\n      msg: 'Email sent'\n    };\n  }).catch(err => {\n    return err;\n  });\n} // send token for password reset\n\n\nfunction forgotPassSubmit(firstName, url, email) {\n  const apiInstance = new SibApiV3Sdk.SMTPApi();\n  let sendSmtpEmail = new SibApiV3Sdk.SendSmtpEmail();\n  sendSmtpEmail.sender = {\n    name: 'eWalletBooster',\n    email: 'support@ewalletbooster.com'\n  };\n  sendSmtpEmail.to = [{\n    email: email,\n    name: firstName\n  }];\n  sendSmtpEmail.replyTo = {\n    email: 'support@ewalletbooster.com'\n  };\n  sendSmtpEmail.templateId = 12;\n  sendSmtpEmail.tags = ['support'];\n  sendSmtpEmail.params = {\n    FNAME: firstName,\n    URL: url\n  };\n  apiInstance.sendTransacEmail(sendSmtpEmail).then(() => {\n    return {\n      success: true,\n      msg: 'Email sent'\n    };\n  }).catch(err => {\n    return err;\n  });\n} // send final monthly stats\n\n\nfunction sendFinalMonthlyStats(report) {\n  User.findById(report.belongsToUser, {\n    password: 0\n  }).then(user => {\n    const {\n      firstName,\n      email\n    } = user;\n    const {\n      brand,\n      monthId,\n      periodId\n    } = report;\n    const currency = report.brand === 'ecoPayz' ? '€' : '$';\n    const accountId = report.account.accountId;\n    const transfers = accounting.formatMoney(report.account.transValue, currency, 2);\n    const cashback = accounting.formatMoney(report.account.cashback, currency, 2);\n    const rate = report.account.cashbackRate === \"NaN%\" ? '0%' : report.account.cashbackRate;\n    const apiInstance = new SibApiV3Sdk.SMTPApi();\n    let sendSmtpEmail = new SibApiV3Sdk.SendSmtpEmail();\n    sendSmtpEmail.sender = {\n      name: 'eWalletBooster',\n      email: 'support@ewalletbooster.com'\n    };\n    sendSmtpEmail.to = [{\n      email: email,\n      name: firstName\n    }];\n    sendSmtpEmail.replyTo = {\n      email: 'support@ewalletbooster.com'\n    };\n    sendSmtpEmail.templateId = 13;\n    sendSmtpEmail.tags = ['stats'];\n    sendSmtpEmail.params = {\n      FNAME: firstName,\n      MONTH: monthId,\n      PERIOD: periodId,\n      ACCOUNTID: accountId,\n      BRAND: brand,\n      TRANSFERS: transfers,\n      CASHBACK: cashback,\n      RATE: rate\n    };\n    apiInstance.sendTransacEmail(sendSmtpEmail).then(() => {\n      return {\n        success: true,\n        msg: 'Email sent'\n      };\n    }).catch(err => {\n      return err;\n    });\n  }).catch(err => {\n    return err;\n  });\n} // send final monthly stats via sms\n\n\nfunction sendFinalMonthlyStatsSMS(report) {\n  User.findById(report.belongsToUser, {\n    password: 0\n  }).then(user => {\n    const {\n      firstName,\n      mobileNumber\n    } = user;\n    const {\n      monthId,\n      brand\n    } = report;\n    const currency = report.brand === 'ecoPayz' ? '€' : '$';\n    const accountId = report.account.accountId;\n    const cashback = accounting.formatMoney(report.account.cashback, currency, 2);\n    const rate = report.account.cashbackRate === \"NaN%\" ? '0%' : report.account.cashbackRate;\n\n    if (verify(mobileNumber) && cashback !== '0%') {\n      const apiInstance = new SibApiV3Sdk.TransactionalSMSApi();\n      let sendTransacSms = new SibApiV3Sdk.SendTransacSms();\n      sendTransacSms.sender = 'EWB';\n      sendTransacSms.recipient = mobileNumber;\n      sendTransacSms.content = `Hi ${firstName}. Your cashback for ${monthId} has been confirmed for ${brand} account ${accountId}. You earned ${cashback} cashback and your average rate was ${rate}. Please login to request payment. Thanks, EWB.`;\n      sendTransacSms.type = 'transactional';\n      sendTransacSms.tag = 'stats';\n      apiInstance.sendTransacSms(sendTransacSms).then(() => {\n        return {\n          success: true,\n          msg: 'SMS sent'\n        };\n      }).catch(err => {\n        return err;\n      });\n    } else return;\n  }).catch(err => {\n    return err;\n  });\n} // send weekly stats on a friday\n\n\nfunction sendMonthStatsOnFriday(report) {\n  User.findById(report.belongsToUser, {\n    password: 0\n  }).then(user => {\n    const {\n      firstName,\n      email\n    } = user;\n    const {\n      brand,\n      monthId,\n      periodId\n    } = report;\n    const currency = report.brand === 'ecoPayz' ? '€' : '$';\n    const accountId = report.account.accountId;\n    const transfers = accounting.formatMoney(report.account.transValue, currency, 2);\n    const cashback = accounting.formatMoney(report.account.cashback, currency, 2);\n    const rate = report.account.cashbackRate === \"NaN%\" ? '0%' : report.account.cashbackRate;\n    const apiInstance = new SibApiV3Sdk.SMTPApi();\n    let sendSmtpEmail = new SibApiV3Sdk.SendSmtpEmail();\n    sendSmtpEmail.sender = {\n      name: 'eWalletBooster',\n      email: 'support@ewalletbooster.com'\n    };\n    sendSmtpEmail.to = [{\n      email: email,\n      name: firstName\n    }];\n    sendSmtpEmail.replyTo = {\n      email: 'support@ewalletbooster.com'\n    };\n    sendSmtpEmail.templateId = 14;\n    sendSmtpEmail.tags = ['stats'];\n    sendSmtpEmail.params = {\n      FNAME: firstName,\n      MONTH: monthId,\n      PERIOD: startOfMonthToYesterday(),\n      ACCOUNTID: accountId,\n      BRAND: brand,\n      TRANSFERS: transfers,\n      CASHBACK: cashback,\n      RATE: rate\n    };\n    apiInstance.sendTransacEmail(sendSmtpEmail).then(() => {\n      return {\n        success: true,\n        msg: 'Email sent'\n      };\n    }).catch(err => {\n      return err;\n    });\n  }).catch(err => {\n    return err;\n  });\n} // send weekly stats on a friday via sms\n\n\nfunction sendMonthStatsOnFridaySMS(report) {\n  User.findById(report.belongsToUser, {\n    password: 0\n  }).then(user => {\n    const {\n      firstName,\n      mobileNumber\n    } = user;\n    const {\n      monthId,\n      brand\n    } = report;\n    const currency = report.brand === 'ecoPayz' ? '€' : '$';\n    const accountId = report.account.accountId;\n    const cashback = accounting.formatMoney(report.account.cashback, currency, 2);\n    const rate = report.account.cashbackRate === \"NaN%\" ? '0%' : report.account.cashbackRate;\n\n    if (verify(mobileNumber) && cashback !== '0%') {\n      const apiInstance = new SibApiV3Sdk.TransactionalSMSApi();\n      let sendTransacSms = new SibApiV3Sdk.SendTransacSms();\n      sendTransacSms.sender = 'EWB';\n      sendTransacSms.recipient = mobileNumber;\n      sendTransacSms.content = `Hi ${firstName}. You've earned ${cashback} cashback in ${monthId} for ${brand} account ${accountId} and your average rate is ${rate}. Wishing you a happy & profitable weekend ahead! Thanks, EWB.`;\n      sendTransacSms.type = 'transactional';\n      sendTransacSms.tag = 'stats';\n      apiInstance.sendTransacSms(sendTransacSms).then(() => {\n        return {\n          success: true,\n          msg: 'SMS sent'\n        };\n      }).catch(err => {\n        return err;\n      });\n    } else return;\n  }).catch(err => {\n    return err;\n  });\n} // send confirmation payment has been processed\n\n\nfunction sendPayoutConfirm(report, user) {\n  const apiInstance = new SibApiV3Sdk.SMTPApi();\n  let sendSmtpEmail = new SibApiV3Sdk.SendSmtpEmail();\n  const {\n    brand,\n    monthId\n  } = report;\n  let {\n    accountId,\n    cashback\n  } = report.account;\n  const {\n    firstName,\n    email\n  } = user;\n  const currency = brand === 'ecoPayz' ? '€' : '$';\n  cashback = accounting.formatMoney(cashback, currency, 2);\n  sendSmtpEmail.sender = {\n    name: 'eWalletBooster',\n    email: 'support@ewalletbooster.com'\n  };\n  sendSmtpEmail.to = [{\n    email: email,\n    name: firstName\n  }];\n  sendSmtpEmail.replyTo = {\n    email: 'support@ewalletbooster.com'\n  };\n  sendSmtpEmail.templateId = 15;\n  sendSmtpEmail.tags = ['payments'];\n  sendSmtpEmail.params = {\n    FNAME: firstName,\n    MONTH: monthId,\n    ACCOUNTID: accountId,\n    CASHBACK: cashback\n  };\n  apiInstance.sendTransacEmail(sendSmtpEmail).then(() => {\n    return {\n      success: true,\n      msg: 'Email sent'\n    };\n  }).catch(err => {\n    return err;\n  });\n} // send payment request when user requests    \n\n\nfunction sendPaymentRequest({\n  accountId,\n  cashback,\n  month\n}, firstName, email, brand) {\n  const apiInstance = new SibApiV3Sdk.SMTPApi();\n  let sendSmtpEmail = new SibApiV3Sdk.SendSmtpEmail();\n  const currency = brand === 'ecoPayz' ? '€' : '$';\n  cashback = accounting.formatMoney(cashback, currency, 2);\n  sendSmtpEmail.sender = {\n    name: 'eWalletBooster',\n    email: 'support@ewalletbooster.com'\n  };\n  sendSmtpEmail.to = [{\n    email: email,\n    name: firstName\n  }];\n  sendSmtpEmail.replyTo = {\n    email: 'support@ewalletbooster.com'\n  };\n  sendSmtpEmail.templateId = 16;\n  sendSmtpEmail.tags = ['payments'];\n  sendSmtpEmail.params = {\n    FNAME: firstName,\n    MONTH: month,\n    ACCOUNTID: accountId,\n    CASHBACK: cashback\n  };\n  apiInstance.sendTransacEmail(sendSmtpEmail).then(() => {\n    return {\n      success: true,\n      msg: 'Email sent'\n    };\n  }).catch(err => {\n    return err;\n  });\n} // contacts\n// create new contact\n\n\nfunction createNewContact({\n  email,\n  firstName,\n  lastName,\n  mobileNumber\n}) {\n  const apiInstance = new SibApiV3Sdk.ContactsApi();\n  let createContact = new SibApiV3Sdk.CreateContact();\n  createContact.email = email;\n  createContact.attributes = {\n    FIRSTNAME: firstName,\n    LASTNAME: lastName,\n    PHONENUMBER: mobileNumber\n  };\n  createContact.listIds = [3];\n  apiInstance.createContact(createContact).then(() => {\n    return {\n      success: true,\n      msg: 'User added'\n    };\n  }).catch(() => {\n    // if contact already exists - update it\n    let updateContact = new SibApiV3Sdk.UpdateContact();\n    updateContact.attributes = {\n      FIRSTNAME: firstName,\n      LASTNAME: lastName,\n      PHONENUMBER: mobileNumber\n    };\n    updateContact.listIds = [3];\n    updateContact.unlinkListIds = [8];\n    apiInstance.updateContact(email, updateContact).then(() => {\n      return {\n        success: true,\n        msg: 'User updated'\n      };\n    }).catch(e => e);\n  });\n} // function getContactInfo (email) {\n//     const apiInstance = new SibApiV3Sdk.ContactsApi();\n//     apiInstance.getContactInfo(email)\n//     .then((res) => {\n//         if (res) {\n//             return true;\n//         }\n//     })\n//     .catch(() => {\n//         return false;\n//     })\n// }\n// function deleteContact (email) {\n//     const apiInstance = new SibApiV3Sdk.ContactsApi();\n//     apiInstance.deleteContact(email)\n//     .then(() => {\n//         return ({ success: true, msg: 'Contact deleted' });   \n//     })\n//     .catch(err => {\n//         return err;\n//     })\n// }\n// adding new partner to partner list\n\n\nfunction addPartnerToList({\n  email\n}) {\n  // adding existing user to different list\n  const apiInstance = new SibApiV3Sdk.ContactsApi();\n  const listId = 5;\n  let contactEmails = new SibApiV3Sdk.AddContactToList();\n  contactEmails.emails = [email];\n  apiInstance.addContactToList(listId, contactEmails).then(() => {\n    return {\n      success: true,\n      msg: 'Partner added'\n    };\n  }).catch(e => e);\n}\n\nfunction addLightSignUpToList(email) {\n  const apiInstance = new SibApiV3Sdk.ContactsApi();\n  let createContact = new SibApiV3Sdk.CreateContact();\n  createContact.email = email;\n  createContact.listIds = [8];\n  apiInstance.createContact(createContact).then(() => {\n    sendLightSignUpEmail(email);\n    return {\n      success: true,\n      msg: 'User added'\n    };\n  }).catch(e => e);\n}\n\nfunction sendLightSignUpEmail(email) {\n  const apiInstance = new SibApiV3Sdk.SMTPApi();\n  let sendSmtpEmail = new SibApiV3Sdk.SendSmtpEmail();\n  sendSmtpEmail.sender = {\n    name: 'eWalletBooster',\n    email: 'support@ewalletbooster.com'\n  };\n  sendSmtpEmail.to = [{\n    email: email\n  }];\n  sendSmtpEmail.replyTo = {\n    email: 'support@ewalletbooster.com'\n  };\n  sendSmtpEmail.templateId = 33;\n  sendSmtpEmail.tags = ['join'];\n  apiInstance.sendTransacEmail(sendSmtpEmail).then(() => {\n    return {\n      success: true,\n      msg: 'Email sent'\n    };\n  }).catch(e => e);\n} // subpartner volume triggered \n\n\nfunction sendSubPartnerActivation(email) {\n  const apiInstance = new SibApiV3Sdk.SMTPApi();\n  let sendSmtpEmail = new SibApiV3Sdk.SendSmtpEmail();\n  sendSmtpEmail.sender = {\n    name: 'eWalletBooster',\n    email: 'support@ewalletbooster.com'\n  };\n  sendSmtpEmail.to = [{\n    email: email\n  }];\n  sendSmtpEmail.replyTo = {\n    email: 'support@ewalletbooster.com'\n  };\n  sendSmtpEmail.templateId = 36;\n  sendSmtpEmail.tags = ['join'];\n  apiInstance.sendTransacEmail(sendSmtpEmail).then(() => {\n    return {\n      success: true,\n      msg: 'Email sent'\n    };\n  }).catch(e => e);\n} // official partner volume triggered \n\n\nfunction sendOfficialPartnerActivation(email) {\n  const apiInstance = new SibApiV3Sdk.SMTPApi();\n  let sendSmtpEmail = new SibApiV3Sdk.SendSmtpEmail();\n  sendSmtpEmail.sender = {\n    name: 'eWalletBooster',\n    email: 'support@ewalletbooster.com'\n  };\n  sendSmtpEmail.to = [{\n    email: email\n  }];\n  sendSmtpEmail.replyTo = {\n    email: 'support@ewalletbooster.com'\n  };\n  sendSmtpEmail.templateId = 37;\n  sendSmtpEmail.tags = ['join'];\n  apiInstance.sendTransacEmail(sendSmtpEmail).then(() => {\n    return {\n      success: true,\n      msg: 'Email sent'\n    };\n  }).catch(e => e);\n} // create new partner\n// partners / affiliates\n// created new partner\n\n\nfunction sendNewPartner(partner) {\n  User.findById(partner.belongsTo, {\n    password: 0\n  }).populate({\n    path: 'partner'\n  }).then(user => {\n    const {\n      firstName,\n      email\n    } = user;\n    const apiInstance = new SibApiV3Sdk.SMTPApi();\n    let sendSmtpEmail = new SibApiV3Sdk.SendSmtpEmail();\n    sendSmtpEmail.sender = {\n      name: 'eWalletBooster',\n      email: 'support@ewalletbooster.com'\n    };\n    sendSmtpEmail.to = [{\n      email: email,\n      name: firstName\n    }];\n    sendSmtpEmail.replyTo = {\n      email: 'support@ewalletbooster.com'\n    };\n    sendSmtpEmail.templateId = 18;\n    sendSmtpEmail.tags = ['partner'];\n    sendSmtpEmail.params = {\n      FNAME: firstName\n    };\n    apiInstance.sendTransacEmail(sendSmtpEmail).then(() => {\n      return {\n        success: true,\n        msg: 'Email sent'\n      };\n    }).catch(err => {\n      return err;\n    });\n  }).catch(err => {\n    return err;\n  });\n} // partner updated payment method\n\n\nfunction sendUpdatedPaymentMethod(partner) {\n  User.findById(partner.belongsTo, {\n    password: 0\n  }).populate({\n    path: 'partner'\n  }).then(user => {\n    const {\n      firstName,\n      email\n    } = user;\n    const apiInstance = new SibApiV3Sdk.SMTPApi();\n    let sendSmtpEmail = new SibApiV3Sdk.SendSmtpEmail();\n    sendSmtpEmail.sender = {\n      name: 'eWalletBooster',\n      email: 'support@ewalletbooster.com'\n    };\n    sendSmtpEmail.to = [{\n      email: email,\n      name: firstName\n    }];\n    sendSmtpEmail.replyTo = {\n      email: 'support@ewalletbooster.com'\n    };\n    sendSmtpEmail.templateId = 19;\n    sendSmtpEmail.tags = ['partner'];\n    sendSmtpEmail.params = {\n      FNAME: firstName\n    };\n    apiInstance.sendTransacEmail(sendSmtpEmail).then(() => {\n      return {\n        success: true,\n        msg: 'Email sent'\n      };\n    }).catch(err => {\n      return err;\n    });\n  }).catch(err => {\n    return err;\n  });\n} // submit aff application\n\n\nfunction sendAffApplicationSubmit(accountId, belongsTo, brand) {\n  AffPartner.findById(belongsTo).then(partner => {\n    User.findById(partner.belongsTo, {\n      password: 0\n    }).populate({\n      path: 'partner'\n    }).then(user => {\n      const {\n        firstName,\n        email\n      } = user;\n      const apiInstance = new SibApiV3Sdk.SMTPApi();\n      let sendSmtpEmail = new SibApiV3Sdk.SendSmtpEmail();\n      sendSmtpEmail.sender = {\n        name: 'eWalletBooster',\n        email: 'support@ewalletbooster.com'\n      };\n      sendSmtpEmail.to = [{\n        email: email,\n        name: firstName\n      }];\n      sendSmtpEmail.replyTo = {\n        email: 'support@ewalletbooster.com'\n      };\n      sendSmtpEmail.templateId = 20;\n      sendSmtpEmail.tags = ['partner'];\n      sendSmtpEmail.params = {\n        FNAME: firstName,\n        ACCOUNTID: accountId,\n        BRAND: brand\n      };\n      apiInstance.sendTransacEmail(sendSmtpEmail).then(() => {\n        return {\n          success: true,\n          msg: 'Email sent'\n        };\n      }).catch(err => {\n        return err;\n      });\n    }).catch(err => {\n      return err;\n    });\n  });\n} // submit vip upgrade request\n\n\nfunction sendVIPRequestSubmit(accountId, belongsTo, brand) {\n  AffPartner.findById(belongsTo).then(partner => {\n    User.findById(partner.belongsTo, {\n      password: 0\n    }).populate({\n      path: 'partner'\n    }).then(user => {\n      const {\n        firstName,\n        email\n      } = user;\n      const apiInstance = new SibApiV3Sdk.SMTPApi();\n      let sendSmtpEmail = new SibApiV3Sdk.SendSmtpEmail();\n      sendSmtpEmail.sender = {\n        name: 'eWalletBooster',\n        email: 'support@ewalletbooster.com'\n      };\n      sendSmtpEmail.to = [{\n        email: email,\n        name: firstName\n      }];\n      sendSmtpEmail.replyTo = {\n        email: 'support@ewalletbooster.com'\n      };\n      sendSmtpEmail.templateId = 21;\n      sendSmtpEmail.tags = ['partner'];\n      sendSmtpEmail.params = {\n        FNAME: firstName,\n        ACCOUNTID: accountId,\n        BRAND: brand\n      };\n      apiInstance.sendTransacEmail(sendSmtpEmail).then(() => {\n        return {\n          success: true,\n          msg: 'Email sent'\n        };\n      }).catch(err => {\n        return err;\n      });\n    }).catch(err => {\n      return err;\n    });\n  });\n} // submit payment request\n\n\nfunction sendAffPaymentRequest(_id, amount, currency) {\n  AffPartner.findById(_id).then(partner => {\n    User.findById(partner.belongsTo, {\n      password: 0\n    }).populate({\n      path: 'partner'\n    }).then(user => {\n      const {\n        firstName,\n        email\n      } = user;\n      amount = amount.toFixed(2);\n      const apiInstance = new SibApiV3Sdk.SMTPApi();\n      let sendSmtpEmail = new SibApiV3Sdk.SendSmtpEmail();\n      sendSmtpEmail.sender = {\n        name: 'eWalletBooster',\n        email: 'support@ewalletbooster.com'\n      };\n      sendSmtpEmail.to = [{\n        email: email,\n        name: firstName\n      }];\n      sendSmtpEmail.replyTo = {\n        email: 'support@ewalletbooster.com'\n      };\n      sendSmtpEmail.templateId = 23;\n      sendSmtpEmail.tags = ['partner'];\n      sendSmtpEmail.params = {\n        FNAME: firstName,\n        AMOUNT: amount,\n        CURRENCY: currency\n      };\n      apiInstance.sendTransacEmail(sendSmtpEmail).then(() => ({\n        success: true,\n        msg: 'Email sent'\n      })).catch(e => e);\n    }).catch(e => e);\n  });\n} // notify of account found from /affiliate-daily\n\n\nfunction sendAffAccountAdded(_id, accountId, brand) {\n  AffPartner.findById(_id).then(partner => {\n    User.findById(partner.belongsTo, {\n      password: 0\n    }).populate({\n      path: 'partner'\n    }).then(user => {\n      const {\n        firstName,\n        email\n      } = user;\n      const apiInstance = new SibApiV3Sdk.SMTPApi();\n      let sendSmtpEmail = new SibApiV3Sdk.SendSmtpEmail();\n      sendSmtpEmail.sender = {\n        name: 'eWalletBooster',\n        email: 'support@ewalletbooster.com'\n      };\n      sendSmtpEmail.to = [{\n        email: email,\n        name: firstName\n      }];\n      sendSmtpEmail.replyTo = {\n        email: 'support@ewalletbooster.com'\n      };\n      sendSmtpEmail.templateId = 22;\n      sendSmtpEmail.tags = ['partner'];\n      sendSmtpEmail.params = {\n        FNAME: firstName,\n        ACCOUNTID: accountId,\n        BRAND: brand\n      };\n      apiInstance.sendTransacEmail(sendSmtpEmail).then(() => {\n        return {\n          success: true,\n          msg: 'Email sent'\n        };\n      }).catch(err => {\n        return err;\n      });\n    }).catch(err => {\n      return err;\n    });\n  });\n} // send aff application result\n\n\nfunction sendAffApplicationResult({\n  belongsTo,\n  accountId,\n  brand\n}, action, reason) {\n  AffPartner.findById(belongsTo).then(partner => {\n    User.findById(partner.belongsTo, {\n      password: 0\n    }).populate({\n      path: 'partner'\n    }).then(user => {\n      const {\n        firstName,\n        email\n      } = user;\n      const apiInstance = new SibApiV3Sdk.SMTPApi();\n      let sendSmtpEmail = new SibApiV3Sdk.SendSmtpEmail();\n      sendSmtpEmail.sender = {\n        name: 'eWalletBooster',\n        email: 'support@ewalletbooster.com'\n      };\n      sendSmtpEmail.to = [{\n        email: email,\n        name: firstName\n      }];\n      const template = action === 'upgraded' ? 24 : action === 'approved' ? 25 : 26;\n      sendSmtpEmail.replyTo = {\n        email: 'support@ewalletbooster.com'\n      };\n      sendSmtpEmail.templateId = template;\n      sendSmtpEmail.tags = ['partner'];\n      sendSmtpEmail.params = {\n        FNAME: firstName,\n        ACCOUNTID: accountId,\n        BRAND: brand,\n        REASON: reason\n      };\n      apiInstance.sendTransacEmail(sendSmtpEmail).then(() => {\n        return {\n          success: true,\n          msg: 'Email sent'\n        };\n      }).catch(err => {\n        return err;\n      });\n    }).catch(err => {\n      return err;\n    });\n  });\n} // send payment confirmed \n\n\nfunction sendPaymentSent(_id, amount) {\n  AffPartner.findById(_id).then(partner => {\n    User.findById(partner.belongsTo, {\n      password: 0\n    }).populate({\n      path: 'partner'\n    }).then(user => {\n      const {\n        firstName,\n        email\n      } = user;\n      const {\n        paymentEmail,\n        paymentBrand\n      } = user.partner;\n      amount = amount.toFixed(2);\n      const apiInstance = new SibApiV3Sdk.SMTPApi();\n      let sendSmtpEmail = new SibApiV3Sdk.SendSmtpEmail();\n      sendSmtpEmail.sender = {\n        name: 'eWalletBooster',\n        email: 'support@ewalletbooster.com'\n      };\n      sendSmtpEmail.to = [{\n        email: email,\n        name: firstName\n      }];\n      sendSmtpEmail.replyTo = {\n        email: 'support@ewalletbooster.com'\n      };\n      sendSmtpEmail.templateId = 27;\n      sendSmtpEmail.tags = ['partner'];\n      sendSmtpEmail.params = {\n        FNAME: firstName,\n        AMOUNT: amount,\n        PAYMENTBRAND: paymentBrand,\n        PAYMENTEMAIL: paymentEmail\n      };\n      apiInstance.sendTransacEmail(sendSmtpEmail).then(() => {\n        return {\n          success: true,\n          msg: 'Email sent'\n        };\n      }).catch(err => {\n        return err;\n      });\n    }).catch(err => {\n      return err;\n    });\n  });\n} // send partner account disabled \n\n\nfunction sendPartnerDisabled(_id) {\n  User.findById(_id, {\n    password: 0\n  }).then(user => {\n    const {\n      firstName,\n      email\n    } = user;\n    const apiInstance = new SibApiV3Sdk.SMTPApi();\n    let sendSmtpEmail = new SibApiV3Sdk.SendSmtpEmail();\n    sendSmtpEmail.sender = {\n      name: 'eWalletBooster',\n      email: 'support@ewalletbooster.com'\n    };\n    sendSmtpEmail.to = [{\n      email: email,\n      name: firstName\n    }];\n    sendSmtpEmail.replyTo = {\n      email: 'support@ewalletbooster.com'\n    };\n    sendSmtpEmail.templateId = 29;\n    sendSmtpEmail.tags = ['partner'];\n    sendSmtpEmail.params = {\n      FNAME: firstName\n    };\n    apiInstance.sendTransacEmail(sendSmtpEmail).then(() => {\n      return {\n        success: true,\n        msg: 'Email sent'\n      };\n    }).catch(err => {\n      return err;\n    });\n  }).catch(err => {\n    return err;\n  });\n} // send ecoPayz request link\n\n\nfunction sendRequestEcoLink(firstName, email) {\n  const apiInstance = new SibApiV3Sdk.SMTPApi();\n  let sendSmtpEmail = new SibApiV3Sdk.SendSmtpEmail();\n  sendSmtpEmail.sender = {\n    name: 'eWalletBooster',\n    email: 'support@ewalletbooster.com'\n  };\n  sendSmtpEmail.to = [{\n    email: email\n  }, {\n    name: 'eWalletBooster',\n    email: 'support@ewalletbooster.com'\n  }];\n  sendSmtpEmail.replyTo = {\n    email\n  };\n  sendSmtpEmail.templateId = 44;\n  sendSmtpEmail.tags = ['partner'];\n  sendSmtpEmail.params = {\n    FNAME: firstName\n  };\n  apiInstance.sendTransacEmail(sendSmtpEmail).then(() => ({\n    success: true,\n    msg: 'Email sent'\n  })).catch(e => e);\n}\n\nfunction sendConfirmedEcoLink(email) {\n  const apiInstance = new SibApiV3Sdk.SMTPApi();\n  let sendSmtpEmail = new SibApiV3Sdk.SendSmtpEmail();\n  sendSmtpEmail.sender = {\n    name: 'eWalletBooster',\n    email: 'support@ewalletbooster.com'\n  };\n  sendSmtpEmail.to = [{\n    email: email\n  }];\n  sendSmtpEmail.replyTo = {\n    email\n  };\n  sendSmtpEmail.templateId = 45;\n  sendSmtpEmail.tags = ['partner'];\n  apiInstance.sendTransacEmail(sendSmtpEmail).then(() => ({\n    success: true,\n    msg: 'Email sent'\n  })).catch(e => e);\n}\n\nmodule.exports = {\n  sendApplicationSubmit,\n  sendApplicationSubmitSMS,\n  sendApplicationResult,\n  sendApplicationResultSMS,\n  sendApplicationLinked,\n  sendBonusStart,\n  sendPercentBonusStart,\n  sendBonusPayment,\n  sendMessage,\n  forgotPassSubmit,\n  sendFinalMonthlyStats,\n  sendFinalMonthlyStatsSMS,\n  sendMonthStatsOnFriday,\n  sendMonthStatsOnFridaySMS,\n  sendPayoutConfirm,\n  sendPaymentRequest,\n  sendWelcomeEmail,\n  createNewContact,\n  sendNewPartner,\n  sendUpdatedPaymentMethod,\n  sendAffApplicationSubmit,\n  sendVIPRequestSubmit,\n  sendAffPaymentRequest,\n  sendAffAccountAdded,\n  sendAffApplicationResult,\n  sendPaymentSent,\n  addPartnerToList,\n  sendPartnerDisabled,\n  addLightSignUpToList,\n  sendOfficialPartnerActivation,\n  sendSubPartnerActivation,\n  sendRequestEcoLink,\n  sendConfirmedEcoLink\n}; // sendPayoutConfirm({\n//     \"_id\": {\n//         \"$oid\": \"5cf4e283a9a7df0004743a02\"\n//     },\n//     \"account\": {\n//         \"accountId\": \"452623321637\",\n//         \"deposits\": 0,\n//         \"transValue\": 9123.69,\n//         \"commission\": 27.37,\n//         \"cashback\": 21.49,\n//         \"cashbackRate\": \"0.24%\"\n//     },\n//     \"timestamp\": {\n//         \"$date\": \"2019-06-03T02:22:08.495Z\"\n//     },\n//     \"monthId\": \"June 2019\",\n//     \"periodId\": \"2019/06/01 - 2019/06/30\",\n//     \"brand\": \"Neteller\",\n//     \"status\": \"Pending\",\n//     \"lastUpdate\": \"July 1st 2019, 5:48:03 pm\",\n//     \"__v\": 0,\n//     \"belongsTo\": {\n//         \"$oid\": \"5be40dd24bc2800004028c99\"\n//     },\n//     \"belongsToUser\": \"5bcdcde930f3d20004cf440e\",\n//     \"paymentEmail\": \"paulmckenna191986@hotmail.co.uk\"\n// },{ isDeleted: false,\n//     _id: '5bcdcde930f3d20004cf440e',\n//     mobileNumber: '+447895008966',\n//     firstName: 'Paul',\n//     lastName: 'McKenna',\n//     email: 'mckennapaul27@gmail.com',\n//     SMS: true,\n//     __v: 0,\n//     resetPasswordExpires: null,\n//     resetPasswordToken: null })\n// sendPaymentRequest(\n//     {\n//         \"_id\": \"5c03ba44f9cbd10004e97f35\",\n//         \"status\": \"Requested\",\n//         \"month\": \"November 2018\",\n//         \"accountId\": \"457325584335\",\n//         \"belongsTo\": \"5be4102a2a2c160004409f18\",\n//         \"cashback\": 139.94,\n//         \"__v\": 0\n//     },\n//     'Paul',\n//     'mckennapaul27@gmail.com',\n//     'Neteller'\n// )\n// sendApplicationResultSMS({firstName: 'Paul', brand: 'Neteller', accountId: '450012345432', mobileNumber: '+447895008966'}, 'approved and upgraded to VIP')\n// sendApplicationResult(\"5d1a0ad2e1e1d47c300b5789\", 'approved and upgraded to VIP')\n// createApplicationLink ('5d135a27e78d6432ca2dd9e5')\n// createNewContact(\n//     { isDeleted: false,\n//     _id: '5bcdcde930f3d20004cf440e',\n//     mobileNumber: '+447895008366',\n//     firstName: 'Paul',\n//     lastName: 'McKenna',\n//     email: 'mckennapaul22227@gmail.com',\n//     SMS: true,\n//     __v: 0,\n//     resetPasswordExpires: null,\n//     resetPasswordToken: null }\n// )","map":{"version":3,"sources":["/Users/user1/Documents/development/greenscapes/greenscapes-domestic/utils/sib.helpers.js"],"names":["path","require","config","join","__dirname","SibApiV3Sdk","defaultClient","ApiClient","instance","apiKey","authentications","process","env","SNDBLAPIKEY","partnerKey","PARTNERSNDBLAPIKEY","verify","phoneNumber","clientCheck","phoneNumbers","fetch","then","catch","sendWelcomeEmail","firstName","email","apiInstance","SMTPApi","sendSmtpEmail","SendSmtpEmail","sender","name","to","replyTo","templateId","tags","params","FNAME","sendTransacEmail","success","msg","err","sendApplicationSubmit","brand","accountId","accountEmailAddress","accountCurrency","typeOfAccount","EMAIL","ACCOUNTID","BRAND","CURRENCY","STATUS","TYPE","sendApplicationSubmitSMS","mobileNumber","TransactionalSMSApi","sendTransacSms","SendTransacSms","recipient","content","type","tag","sendApplicationResult","_id","subJoinText","template","Application","findById","a","vipStatus","getVipRequestText","belongsTo","SUBJOINTEXT","VIPUPGRADETEXT","application","Promise","all","crypto","randomBytes","buffer","token","toString","findByIdAndUpdate","applicationToken","applicationExpires","Date","now","upsert","new","ID","sendApplicationResultSMS","sendApplicationLinked","sendBonusStart","status","value","currency","bonusValue","transRequirement","VALUE","REQUIREMENT","sendPercentBonusStart","startDate","endDate","start","moment","format","end","START","END","sendBonusPayment","toFixed","sendMessage","message","date","DATE","MESSAGE","forgotPassSubmit","url","URL","sendFinalMonthlyStats","report","User","belongsToUser","password","user","monthId","periodId","account","transfers","accounting","formatMoney","transValue","cashback","rate","cashbackRate","MONTH","PERIOD","TRANSFERS","CASHBACK","RATE","sendFinalMonthlyStatsSMS","sendMonthStatsOnFriday","startOfMonthToYesterday","sendMonthStatsOnFridaySMS","sendPayoutConfirm","sendPaymentRequest","month","createNewContact","lastName","ContactsApi","createContact","CreateContact","attributes","FIRSTNAME","LASTNAME","PHONENUMBER","listIds","updateContact","UpdateContact","unlinkListIds","e","addPartnerToList","listId","contactEmails","AddContactToList","emails","addContactToList","addLightSignUpToList","sendLightSignUpEmail","sendSubPartnerActivation","sendOfficialPartnerActivation","sendNewPartner","partner","populate","sendUpdatedPaymentMethod","sendAffApplicationSubmit","AffPartner","sendVIPRequestSubmit","sendAffPaymentRequest","amount","AMOUNT","sendAffAccountAdded","sendAffApplicationResult","action","reason","REASON","sendPaymentSent","paymentEmail","paymentBrand","PAYMENTBRAND","PAYMENTEMAIL","sendPartnerDisabled","sendRequestEcoLink","sendConfirmedEcoLink","module","exports"],"mappings":"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","sourcesContent":["const path = require('path');\nrequire('dotenv').config({path: path.join(__dirname, '../.env')});\n\n// const accountSid = process.env.TWILIO_ACCOUNT_SID;\n// const authToken = process.env.TWILIO_AUTH_TOKEN;\n// const twilio = require('twilio');\n// const clientCheck = twilio(accountSid, authToken).lookups.v1;\n\nconst SibApiV3Sdk = require('sib-api-v3-sdk');\nconst defaultClient = SibApiV3Sdk.ApiClient.instance;\n\n// const { getVipRequestText } = require('../utils/api.helpers')\n// const { Application, User } = require('../models/index');\n// const { AffPartner } = require('../models/affiliates/index')\n\n// const crypto = require('crypto');\n// const moment = require('moment');\n// const accounting = require('accounting'); \n// const startOfMonthToYesterday = () => moment().startOf('month').add(12, 'hours').format('DD/MM/YYYY') + ' - ' + moment().subtract(1, 'days').format('DD/MM/YYYY');\n// Configure API key authorization: api-key\nlet apiKey = defaultClient.authentications['api-key'];\napiKey.apiKey = process.env.SNDBLAPIKEY;\n\n// Configure API key authorization: partner-key\nlet partnerKey = defaultClient.authentications['partner-key'];\npartnerKey.apiKey = process.env.PARTNERSNDBLAPIKEY;\n\n\n// function to verify mobile number is correct\nfunction verify(phoneNumber) {\n    return clientCheck.phoneNumbers(phoneNumber).fetch()\n    .then(() => {\n        return true;\n    })\n    .catch(() => {\n        return false;\n    })\n}\n\n// send welcome email\nfunction sendWelcomeEmail ({firstName, email}) {\n    const apiInstance = new SibApiV3Sdk.SMTPApi();\n    let sendSmtpEmail = new SibApiV3Sdk.SendSmtpEmail() \n    sendSmtpEmail.sender = {\n        name: 'eWalletBooster',\n        email: 'support@ewalletbooster.com'\n    }\n    sendSmtpEmail.to = [{\n        email: email, \n        name: firstName\n    }];\n    sendSmtpEmail.replyTo = {email: 'support@ewalletbooster.com'};\n    sendSmtpEmail.templateId = 17;\n    sendSmtpEmail.tags = ['join'];\n    sendSmtpEmail.params = {\n        FNAME: firstName\n    }\n    apiInstance.sendTransacEmail(sendSmtpEmail)\n    .then(() => {\n        return ({success: true, msg: 'Email sent'});       \n    })\n    .catch(err => {\n        return err;\n    })\n}\n// send application submitted email regardless of whether belongsTo 'Account' as based on req.body data\nfunction sendApplicationSubmit ({ firstName, email, brand, accountId, accountEmailAddress, accountCurrency, typeOfAccount }) {\n\n    const apiInstance = new SibApiV3Sdk.SMTPApi();\n    let sendSmtpEmail = new SibApiV3Sdk.SendSmtpEmail() \n    sendSmtpEmail.sender = {\n        name: 'eWalletBooster',\n        email: 'support@ewalletbooster.com'\n    }\n    sendSmtpEmail.to = [{\n        email: email, \n        name: firstName\n    }];\n    sendSmtpEmail.replyTo = {email: 'support@ewalletbooster.com'};\n    sendSmtpEmail.templateId = 1;\n    sendSmtpEmail.tags = ['application'];\n    sendSmtpEmail.params = {\n        FNAME: firstName,\n        EMAIL: accountEmailAddress,\n        ACCOUNTID: accountId,\n        BRAND: brand,\n        CURRENCY: accountCurrency,\n        STATUS: 'Pending',\n        TYPE: typeOfAccount\n    }\n    apiInstance.sendTransacEmail(sendSmtpEmail)\n    .then(() => {\n        return ({success: true, msg: 'Email sent'});       \n    })\n    .catch(err => {\n        return err;\n    })\n}\n// send application submitted SMS regardless of whether belongsTo 'Account' as based on req.body data\nfunction sendApplicationSubmitSMS ({ firstName, brand, accountId, mobileNumber }) {\n\n    if (verify(mobileNumber)) {\n\n        const apiInstance = new SibApiV3Sdk.TransactionalSMSApi();\n        let sendTransacSms = new SibApiV3Sdk.SendTransacSms();\n\n        sendTransacSms.sender = 'EWB';\n        sendTransacSms.recipient = mobileNumber;\n        sendTransacSms.content = `Hi ${firstName}. We have received your ${brand} application for ${accountId}. You will receive a response soon. Thanks, EWB.`;\n        sendTransacSms.type = 'transactional';\n        sendTransacSms.tag = 'application';\n\n        apiInstance.sendTransacSms(sendTransacSms)\n        .then(() => {\n            return ({success: true, msg: 'SMS sent'});       \n        })\n        .catch(err => {\n            return err;\n        })\n    } else return;\n}\n// send application result regardless of belongsTo using different templateId's\nfunction sendApplicationResult ( _id, subJoinText ) {\n\n    const apiInstance = new SibApiV3Sdk.SMTPApi();\n    let sendSmtpEmail = new SibApiV3Sdk.SendSmtpEmail();\n    const template = {\n        'approved': 2,\n        'approved and upgraded to VIP': 2,\n        'declined': 3,\n        'approved for cashback': 28,\n        'approved for cashback and upgraded to VIP': 28\n    }\n    sendSmtpEmail.sender = {\n        name: 'eWalletBooster',\n        email: 'support@ewalletbooster.com'\n    }\n    sendSmtpEmail.replyTo = {email: 'support@ewalletbooster.com'};\n    sendSmtpEmail.tags = ['application'];\n\n    Application.findById(_id)\n    .then(a => {\n        const vipStatus = getVipRequestText(subJoinText);\n        sendSmtpEmail.to = [{\n            email: a.accountEmailAddress,\n            name: a.firstName\n        }];\n        if (a.belongsTo) {\n            sendSmtpEmail.templateId = template[subJoinText];\n            sendSmtpEmail.params = {\n                FNAME: a.firstName,\n                EMAIL: a.accountEmailAddress,\n                ACCOUNTID: a.accountId,\n                BRAND: a.brand,\n                CURRENCY: a.accountCurrency,\n                SUBJOINTEXT: subJoinText,\n                VIPUPGRADETEXT: vipStatus\n            }\n            apiInstance.sendTransacEmail(sendSmtpEmail)\n            .then(() => {\n                return ({success: true, msg: 'Email sent'});       \n            })\n            .catch(err => {\n                return err;\n            })\n        } else {\n            Application.findById(a._id)\n            .then(application => {\n                Promise.all([application, crypto.randomBytes(20)])\n                .then(([application, buffer]) => {\n                    const token = buffer.toString('hex');\n                    Application.findByIdAndUpdate(application._id, \n                        {applicationToken: token, applicationExpires: Date.now() + 86400000},\n                        {upsert: true, new: true}\n                    )\n                    .then(() => {\n                        sendSmtpEmail.templateId = subJoinText === 'declined' ? 3 : 4;\n                        sendSmtpEmail.params = {\n                            FNAME: a.firstName,\n                            EMAIL: a.accountEmailAddress,\n                            ACCOUNTID: a.accountId,\n                            BRAND: a.brand,\n                            CURRENCY: a.accountCurrency,\n                            SUBJOINTEXT: subJoinText,\n                            VIPUPGRADETEXT: vipStatus,\n                            ID: token\n                        }\n                        apiInstance.sendTransacEmail(sendSmtpEmail)\n                        .then(() => {\n                            return ({success: true, msg: 'Email sent'});       \n                        })\n                        .catch(err => {\n                            return err;\n                        })\n                    })\n                    .catch(err => {\n                        return err;\n                    })\n                })\n                .catch(err => {\n                    return err;\n                })\n            })\n            .catch(err => {\n                return err;\n            })\n        }\n    })\n    .catch(err => {\n        return err;\n    })\n}\n// send application result sms text\nfunction sendApplicationResultSMS ({ firstName, brand, accountId, mobileNumber }, subJoinText) {\n\n    if (verify(mobileNumber)) {\n\n        const apiInstance = new SibApiV3Sdk.TransactionalSMSApi();\n        let sendTransacSms = new SibApiV3Sdk.SendTransacSms();\n\n        sendTransacSms.sender = 'EWB';\n        sendTransacSms.recipient = mobileNumber;\n        sendTransacSms.content = `Hi ${firstName}. Your ${brand} application for ${accountId} has been ${subJoinText}. Thanks, EWB.`;\n        sendTransacSms.type = 'transactional';\n        sendTransacSms.tag = 'application';\n\n        apiInstance.sendTransacSms(sendTransacSms)\n        .then(() => {\n            return ({success: true, msg: 'SMS sent'});       \n        })\n        .catch(err => {\n            return err;\n        })\n    } else return;\n}\n// send confirmation of application linked\nfunction sendApplicationLinked ({ firstName, brand, accountId, email }) {\n    const apiInstance = new SibApiV3Sdk.SMTPApi();\n    let sendSmtpEmail = new SibApiV3Sdk.SendSmtpEmail() \n    sendSmtpEmail.sender = {\n        name: 'eWalletBooster',\n        email: 'support@ewalletbooster.com'\n    }\n    sendSmtpEmail.to = [{\n        email: email, \n        name: firstName\n    }];\n    sendSmtpEmail.replyTo = {email: 'support@ewalletbooster.com'};\n    sendSmtpEmail.templateId = 6;\n    sendSmtpEmail.tags = ['application'];\n    sendSmtpEmail.params = {\n        FNAME: firstName,\n        ACCOUNTID: accountId,\n        BRAND: brand\n    }\n    apiInstance.sendTransacEmail(sendSmtpEmail)\n    .then(() => {\n        return ({success: true, msg: 'Email sent'});       \n    })\n    .catch(err => {\n        return err;\n    })\n}\n// send bonus start\nfunction sendBonusStart({status, value, accountId, brand}, email, firstName) {\n    const apiInstance = new SibApiV3Sdk.SMTPApi();\n    let sendSmtpEmail = new SibApiV3Sdk.SendSmtpEmail();\n    const currency = brand === 'ecoPayz' ? '€' : '$';\n    const bonusValue = currency + value; \n    const transRequirement = brand === 'Skrill' ? '$3,500' : brand === 'ecoPayz' ? '€5,000' : '$2,000';\n    sendSmtpEmail.sender = {\n        name: 'eWalletBooster',\n        email: 'support@ewalletbooster.com'\n    }\n    sendSmtpEmail.to = [{\n        email: email, \n        name: firstName\n    }];\n    sendSmtpEmail.replyTo = {email: 'support@ewalletbooster.com'};\n    sendSmtpEmail.templateId = 7;\n    sendSmtpEmail.tags = ['bonus'];\n    sendSmtpEmail.params = {\n        FNAME: firstName,\n        ACCOUNTID: accountId,\n        BRAND: brand,\n        STATUS: status,\n        VALUE: bonusValue,\n        REQUIREMENT: transRequirement\n    }\n    apiInstance.sendTransacEmail(sendSmtpEmail)\n    .then(() => {\n        return ({success: true, msg: 'Email sent'});       \n    })\n    .catch(err => {\n        return err;\n    })\n}\n// send bonus start for neteller 1% bonus\nfunction sendPercentBonusStart ({status, accountId, brand, startDate, endDate}, email, firstName) {\n    const apiInstance = new SibApiV3Sdk.SMTPApi();\n    let sendSmtpEmail = new SibApiV3Sdk.SendSmtpEmail();\n    const start = moment(startDate).format('DD/MM/YYYY');\n    const end = moment(endDate).format('DD/MM/YYYY');\n    sendSmtpEmail.sender = {\n        name: 'eWalletBooster',\n        email: 'support@ewalletbooster.com'\n    }\n    sendSmtpEmail.to = [{\n        email: email, \n        name: firstName\n    }];\n    sendSmtpEmail.replyTo = {email: 'support@ewalletbooster.com'};\n    sendSmtpEmail.templateId = 8;\n    sendSmtpEmail.tags = ['bonus'];\n    sendSmtpEmail.params = {\n        FNAME: firstName,\n        ACCOUNTID: accountId,\n        BRAND: brand,\n        STATUS: status,\n        START: start,\n        END: end\n    }\n    apiInstance.sendTransacEmail(sendSmtpEmail)\n    .then(() => {\n        return ({success: true, msg: 'Email sent'});       \n    })\n    .catch(err => {\n        return err;\n    })\n}\n// send confirmation bonus paid\nfunction sendBonusPayment({value, brand, accountId}, {firstName, email}) {\n    const apiInstance = new SibApiV3Sdk.SMTPApi();\n    let sendSmtpEmail = new SibApiV3Sdk.SendSmtpEmail();\n    const currency = brand === 'ecoPayz' ? '€' : '$';\n    const bonusValue = currency + (value.toFixed(2)); \n    sendSmtpEmail.sender = {\n        name: 'eWalletBooster',\n        email: 'support@ewalletbooster.com'\n    }\n    sendSmtpEmail.to = [{\n        email: email, \n        name: firstName\n    }];\n    sendSmtpEmail.replyTo = {email: 'support@ewalletbooster.com'};\n    sendSmtpEmail.templateId = 10;\n    sendSmtpEmail.tags = ['bonus'];\n    sendSmtpEmail.params = {\n        FNAME: firstName,\n        ACCOUNTID: accountId,\n        BRAND: brand,\n        VALUE: bonusValue\n    }\n    apiInstance.sendTransacEmail(sendSmtpEmail)\n    .then(() => {\n        return ({success: true, msg: 'Email sent'});       \n    })\n    .catch(err => {\n        return err;\n    })\n}\n// send contact form submitted\nfunction sendMessage({name, email, message}, date) {\n    const apiInstance = new SibApiV3Sdk.SMTPApi();\n    let sendSmtpEmail = new SibApiV3Sdk.SendSmtpEmail();\n    \n    sendSmtpEmail.sender = {\n        name: 'eWalletBooster',\n        email: 'support@ewalletbooster.com'\n    }\n    sendSmtpEmail.to = [{email: email, name: name}, {name: 'eWalletBooster', email: 'support@ewalletbooster.com'}];\n    sendSmtpEmail.replyTo = {email: email};\n    sendSmtpEmail.templateId = 11;\n    sendSmtpEmail.tags = ['support'];\n    sendSmtpEmail.params = {\n        FNAME: name,\n        DATE: date,\n        MESSAGE: message,\n        EMAIL: email\n    }\n    apiInstance.sendTransacEmail(sendSmtpEmail)\n    .then(() => {\n        return ({success: true, msg: 'Email sent'});       \n    })\n    .catch(err => {\n        return err;\n    })\n}\n// send token for password reset\nfunction forgotPassSubmit(firstName, url, email) {\n    const apiInstance = new SibApiV3Sdk.SMTPApi();\n    let sendSmtpEmail = new SibApiV3Sdk.SendSmtpEmail();\n    sendSmtpEmail.sender = {\n        name: 'eWalletBooster',\n        email: 'support@ewalletbooster.com'\n    }\n    sendSmtpEmail.to = [{\n        email: email, \n        name: firstName\n    }];\n    sendSmtpEmail.replyTo = {email: 'support@ewalletbooster.com'};\n    sendSmtpEmail.templateId = 12;\n    sendSmtpEmail.tags = ['support'];\n    sendSmtpEmail.params = {\n        FNAME: firstName,\n        URL: url\n    }\n    apiInstance.sendTransacEmail(sendSmtpEmail)\n    .then(() => {\n        return ({success: true, msg: 'Email sent'});       \n    })\n    .catch(err => {\n        return err;\n    })\n}\n// send final monthly stats\nfunction sendFinalMonthlyStats (report) {\n    User.findById(report.belongsToUser, {password: 0})\n    .then(user => {\n        const {\n            firstName,\n            email\n        } = user;\n        const {\n            brand,\n            monthId,\n            periodId\n        } = report;\n        const currency = report.brand === 'ecoPayz' ? '€' : '$';\n        const accountId = report.account.accountId;\n        const transfers = accounting.formatMoney(report.account.transValue, currency, 2);     \n        const cashback = accounting.formatMoney(report.account.cashback, currency, 2);\n        const rate = report.account.cashbackRate === \"NaN%\" ? '0%' : report.account.cashbackRate;\n        \n        const apiInstance = new SibApiV3Sdk.SMTPApi();\n        let sendSmtpEmail = new SibApiV3Sdk.SendSmtpEmail();\n\n        sendSmtpEmail.sender = {\n            name: 'eWalletBooster',\n            email: 'support@ewalletbooster.com'\n        }\n        sendSmtpEmail.to = [{\n            email: email, \n            name: firstName\n        }];\n        sendSmtpEmail.replyTo = {email: 'support@ewalletbooster.com'};\n        sendSmtpEmail.templateId = 13;\n        sendSmtpEmail.tags = ['stats'];\n        sendSmtpEmail.params = {\n            FNAME: firstName,\n            MONTH: monthId,\n            PERIOD: periodId,\n            ACCOUNTID: accountId,\n            BRAND: brand,\n            TRANSFERS: transfers,\n            CASHBACK: cashback,\n            RATE: rate\n        }\n        apiInstance.sendTransacEmail(sendSmtpEmail)\n        .then(() => {\n            return ({success: true, msg: 'Email sent'});       \n        })\n        .catch(err => {\n            return err;\n        })\n    })\n    .catch(err => {\n        return err;\n    });   \n}\n// send final monthly stats via sms\nfunction sendFinalMonthlyStatsSMS (report) {\n    User.findById(report.belongsToUser, {password: 0})\n    .then(user => {\n        const {\n            firstName,\n            mobileNumber\n        } = user;\n        const {\n            monthId,\n            brand\n        } = report;\n\n        const currency = report.brand === 'ecoPayz' ? '€' : '$';\n        const accountId = report.account.accountId;\n        const cashback = accounting.formatMoney(report.account.cashback, currency, 2);\n        const rate = report.account.cashbackRate === \"NaN%\" ? '0%' : report.account.cashbackRate;\n\n        if (verify(mobileNumber) && cashback !== '0%') {\n\n            const apiInstance = new SibApiV3Sdk.TransactionalSMSApi();\n            let sendTransacSms = new SibApiV3Sdk.SendTransacSms();\n\n            sendTransacSms.sender = 'EWB';\n            sendTransacSms.recipient = mobileNumber;\n            sendTransacSms.content = `Hi ${firstName}. Your cashback for ${monthId} has been confirmed for ${brand} account ${accountId}. You earned ${cashback} cashback and your average rate was ${rate}. Please login to request payment. Thanks, EWB.`;\n            sendTransacSms.type = 'transactional';\n            sendTransacSms.tag = 'stats';\n\n            apiInstance.sendTransacSms(sendTransacSms)\n            .then(() => {\n                return ({success: true, msg: 'SMS sent'});       \n            })\n            .catch(err => {\n                return err;\n            })\n        } else return;\n    })\n    .catch(err => {\n        return err;\n    });\n}\n// send weekly stats on a friday\nfunction sendMonthStatsOnFriday (report) {\n    User.findById(report.belongsToUser, {password: 0})\n    .then(user => {\n        const {\n            firstName,\n            email\n        } = user;\n        const {\n            brand,\n            monthId,\n            periodId\n        } = report;\n        const currency = report.brand === 'ecoPayz' ? '€' : '$';\n        const accountId = report.account.accountId;\n        const transfers = accounting.formatMoney(report.account.transValue, currency, 2);     \n        const cashback = accounting.formatMoney(report.account.cashback, currency, 2);\n        const rate = report.account.cashbackRate === \"NaN%\" ? '0%' : report.account.cashbackRate;\n        \n        const apiInstance = new SibApiV3Sdk.SMTPApi();\n        let sendSmtpEmail = new SibApiV3Sdk.SendSmtpEmail();\n\n        sendSmtpEmail.sender = {\n            name: 'eWalletBooster',\n            email: 'support@ewalletbooster.com'\n        }\n        sendSmtpEmail.to = [{\n            email: email, \n            name: firstName\n        }];\n        sendSmtpEmail.replyTo = {email: 'support@ewalletbooster.com'};\n        sendSmtpEmail.templateId = 14;\n        sendSmtpEmail.tags = ['stats'];\n        sendSmtpEmail.params = {\n            FNAME: firstName,\n            MONTH: monthId,\n            PERIOD: startOfMonthToYesterday(),\n            ACCOUNTID: accountId,\n            BRAND: brand,\n            TRANSFERS: transfers,\n            CASHBACK: cashback,\n            RATE: rate\n        }\n        apiInstance.sendTransacEmail(sendSmtpEmail)\n        .then(() => {\n            return ({success: true, msg: 'Email sent'});       \n        })\n        .catch(err => {\n            return err;\n        })\n    })\n    .catch(err => {\n        return err;\n    });   \n}\n// send weekly stats on a friday via sms\nfunction sendMonthStatsOnFridaySMS (report) {\n    User.findById(report.belongsToUser, {password: 0})\n    .then(user => {\n        const {\n            firstName,\n            mobileNumber\n        } = user;\n        const {\n            monthId,\n            brand\n        } = report;\n\n        const currency = report.brand === 'ecoPayz' ? '€' : '$';\n        const accountId = report.account.accountId;\n        const cashback = accounting.formatMoney(report.account.cashback, currency, 2);\n        const rate = report.account.cashbackRate === \"NaN%\" ? '0%' : report.account.cashbackRate;\n\n        if (verify(mobileNumber) && cashback !== '0%') {\n\n            const apiInstance = new SibApiV3Sdk.TransactionalSMSApi();\n            let sendTransacSms = new SibApiV3Sdk.SendTransacSms();\n\n            sendTransacSms.sender = 'EWB';\n            sendTransacSms.recipient = mobileNumber;\n            sendTransacSms.content = `Hi ${firstName}. You've earned ${cashback} cashback in ${monthId} for ${brand} account ${accountId} and your average rate is ${rate}. Wishing you a happy & profitable weekend ahead! Thanks, EWB.`;\n            sendTransacSms.type = 'transactional';\n            sendTransacSms.tag = 'stats';\n\n            apiInstance.sendTransacSms(sendTransacSms)\n            .then(() => {\n                return ({success: true, msg: 'SMS sent'});       \n            })\n            .catch(err => {\n                return err;\n            })\n        } else return;\n    })\n    .catch(err => {\n        return err;\n    });\n}\n// send confirmation payment has been processed\nfunction sendPayoutConfirm (report, user) {\n    const apiInstance = new SibApiV3Sdk.SMTPApi();\n    let sendSmtpEmail = new SibApiV3Sdk.SendSmtpEmail();\n    const {\n        brand,\n        monthId\n    } = report;\n    let {\n        accountId,\n        cashback\n    } = report.account;\n    const {\n        firstName,\n        email\n    } = user;\n\n    const currency = brand === 'ecoPayz' ? '€' : '$';\n    cashback = accounting.formatMoney(cashback, currency, 2);\n\n    sendSmtpEmail.sender = {\n        name: 'eWalletBooster',\n        email: 'support@ewalletbooster.com'\n    }\n    sendSmtpEmail.to = [{\n        email: email, \n        name: firstName\n    }];\n    sendSmtpEmail.replyTo = {email: 'support@ewalletbooster.com'};\n    sendSmtpEmail.templateId = 15;\n    sendSmtpEmail.tags = ['payments'];\n    sendSmtpEmail.params = {\n        FNAME: firstName,\n        MONTH: monthId,\n        ACCOUNTID: accountId,\n        CASHBACK: cashback\n    }\n    apiInstance.sendTransacEmail(sendSmtpEmail)\n    .then(() => {\n        return ({success: true, msg: 'Email sent'});       \n    })\n    .catch(err => {\n        return err;\n    })\n}\n// send payment request when user requests    \nfunction sendPaymentRequest({accountId, cashback, month}, firstName, email, brand) {\n    const apiInstance = new SibApiV3Sdk.SMTPApi();\n    let sendSmtpEmail = new SibApiV3Sdk.SendSmtpEmail();\n\n    const currency = brand === 'ecoPayz' ? '€' : '$';          \n    cashback = accounting.formatMoney(cashback, currency, 2);  \n\n    sendSmtpEmail.sender = {\n        name: 'eWalletBooster',\n        email: 'support@ewalletbooster.com'\n    }\n    sendSmtpEmail.to = [{\n        email: email, \n        name: firstName\n    }];\n    sendSmtpEmail.replyTo = {email: 'support@ewalletbooster.com'};\n    sendSmtpEmail.templateId = 16;\n    sendSmtpEmail.tags = ['payments'];\n    sendSmtpEmail.params = {\n        FNAME: firstName,\n        MONTH: month,\n        ACCOUNTID: accountId,\n        CASHBACK: cashback\n    }\n    apiInstance.sendTransacEmail(sendSmtpEmail)\n    .then(() => {\n        return ({success: true, msg: 'Email sent'});       \n    })\n    .catch(err => {\n        return err;\n    })\n}\n// contacts\n\n// create new contact\nfunction createNewContact ({ email, firstName, lastName, mobileNumber }) {\n    const apiInstance = new SibApiV3Sdk.ContactsApi();\n    let createContact = new SibApiV3Sdk.CreateContact();\n    createContact.email = email;\n    createContact.attributes = {\n        FIRSTNAME: firstName,\n        LASTNAME: lastName,\n        PHONENUMBER: mobileNumber\n    }\n    createContact.listIds = [3];\n    apiInstance.createContact(createContact)\n    .then(() => {\n        return ({ success: true, msg: 'User added' });   \n    })\n    .catch(() => {\n        // if contact already exists - update it\n        let updateContact = new SibApiV3Sdk.UpdateContact();\n        updateContact.attributes = {\n            FIRSTNAME: firstName,\n            LASTNAME: lastName,\n            PHONENUMBER: mobileNumber\n        }\n        updateContact.listIds = [3];\n        updateContact.unlinkListIds = [8];\n        apiInstance.updateContact(email, updateContact)\n        .then(() => {\n            return ({ success: true, msg: 'User updated' });   \n        })\n        .catch(e => e)\n    })\n}\n\n// function getContactInfo (email) {\n//     const apiInstance = new SibApiV3Sdk.ContactsApi();\n//     apiInstance.getContactInfo(email)\n//     .then((res) => {\n//         if (res) {\n//             return true;\n//         }\n//     })\n//     .catch(() => {\n//         return false;\n//     })\n// }\n\n// function deleteContact (email) {\n//     const apiInstance = new SibApiV3Sdk.ContactsApi();\n//     apiInstance.deleteContact(email)\n//     .then(() => {\n//         return ({ success: true, msg: 'Contact deleted' });   \n//     })\n//     .catch(err => {\n//         return err;\n//     })\n// }\n\n// adding new partner to partner list\nfunction addPartnerToList ({ email }) {\n    // adding existing user to different list\n    const apiInstance = new SibApiV3Sdk.ContactsApi();\n    const listId = 5;\n    let contactEmails = new SibApiV3Sdk.AddContactToList();\n    contactEmails.emails = [email]\n    apiInstance.addContactToList(listId, contactEmails)\n    .then(() => {\n        return ({success: true, msg: 'Partner added'});   \n    })\n    .catch(e => e)\n}\n\nfunction addLightSignUpToList (email) {\n    const apiInstance = new SibApiV3Sdk.ContactsApi();\n    let createContact = new SibApiV3Sdk.CreateContact();\n    createContact.email = email;\n    createContact.listIds = [8]\n    apiInstance.createContact(createContact)\n    .then(() => {\n        sendLightSignUpEmail(email)\n        return ({ success: true, msg: 'User added' });   \n    })\n    .catch(e => e)\n}\n\nfunction sendLightSignUpEmail (email) {\n    const apiInstance = new SibApiV3Sdk.SMTPApi();\n    let sendSmtpEmail = new SibApiV3Sdk.SendSmtpEmail() \n    sendSmtpEmail.sender = {\n        name: 'eWalletBooster',\n        email: 'support@ewalletbooster.com'\n    }\n    sendSmtpEmail.to = [{\n        email: email\n    }];\n    sendSmtpEmail.replyTo = { email: 'support@ewalletbooster.com' };\n    sendSmtpEmail.templateId = 33;\n    sendSmtpEmail.tags = ['join'];\n    apiInstance.sendTransacEmail(sendSmtpEmail)\n    .then(() => {\n        return ({ success: true, msg: 'Email sent' });       \n    })\n    .catch(e => e)\n}\n\n// subpartner volume triggered \nfunction sendSubPartnerActivation (email) {\n    const apiInstance = new SibApiV3Sdk.SMTPApi();\n    let sendSmtpEmail = new SibApiV3Sdk.SendSmtpEmail() \n    sendSmtpEmail.sender = {\n        name: 'eWalletBooster',\n        email: 'support@ewalletbooster.com'\n    }\n    sendSmtpEmail.to = [{\n        email: email\n    }];\n    sendSmtpEmail.replyTo = { email: 'support@ewalletbooster.com' };\n    sendSmtpEmail.templateId = 36;\n    sendSmtpEmail.tags = ['join'];\n    apiInstance.sendTransacEmail(sendSmtpEmail)\n    .then(() => {\n        return ({ success: true, msg: 'Email sent' });       \n    })\n    .catch(e => e)\n}\n\n// official partner volume triggered \nfunction sendOfficialPartnerActivation (email) {\n    const apiInstance = new SibApiV3Sdk.SMTPApi();\n    let sendSmtpEmail = new SibApiV3Sdk.SendSmtpEmail() \n    sendSmtpEmail.sender = {\n        name: 'eWalletBooster',\n        email: 'support@ewalletbooster.com'\n    }\n    sendSmtpEmail.to = [{\n        email: email\n    }];\n    sendSmtpEmail.replyTo = { email: 'support@ewalletbooster.com' };\n    sendSmtpEmail.templateId = 37;\n    sendSmtpEmail.tags = ['join'];\n    apiInstance.sendTransacEmail(sendSmtpEmail)\n    .then(() => {\n        return ({ success: true, msg: 'Email sent' });       \n    })\n    .catch(e => e)\n}\n\n// create new partner\n\n// partners / affiliates\n\n// created new partner\nfunction sendNewPartner (partner) {\n    User.findById(partner.belongsTo, {password: 0}).populate({ path: 'partner' })\n    .then(user => {\n        const { firstName, email } = user;\n\n        const apiInstance = new SibApiV3Sdk.SMTPApi();\n        let sendSmtpEmail = new SibApiV3Sdk.SendSmtpEmail();\n\n        sendSmtpEmail.sender = {\n            name: 'eWalletBooster',\n            email: 'support@ewalletbooster.com'\n        };\n        sendSmtpEmail.to = [{\n            email: email, \n            name: firstName\n        }];\n        sendSmtpEmail.replyTo = {email: 'support@ewalletbooster.com'};\n        sendSmtpEmail.templateId = 18;\n        sendSmtpEmail.tags = ['partner'];\n        sendSmtpEmail.params = {\n            FNAME: firstName,\n        }\n        apiInstance.sendTransacEmail(sendSmtpEmail)\n        .then(() => {\n            return ({success: true, msg: 'Email sent'});       \n        })\n        .catch(err => {\n            return err;\n        })\n    })\n    .catch(err => {\n        return err;\n    }); \n}\n\n// partner updated payment method\nfunction sendUpdatedPaymentMethod (partner) {\n    User.findById(partner.belongsTo, {password: 0}).populate({ path: 'partner' })\n    .then(user => {\n        const { firstName, email } = user;\n\n        const apiInstance = new SibApiV3Sdk.SMTPApi();\n        let sendSmtpEmail = new SibApiV3Sdk.SendSmtpEmail();\n\n        sendSmtpEmail.sender = {\n            name: 'eWalletBooster',\n            email: 'support@ewalletbooster.com'\n        };\n        sendSmtpEmail.to = [{\n            email: email, \n            name: firstName\n        }];\n        sendSmtpEmail.replyTo = {email: 'support@ewalletbooster.com'};\n        sendSmtpEmail.templateId = 19;\n        sendSmtpEmail.tags = ['partner'];\n        sendSmtpEmail.params = {\n            FNAME: firstName,\n        }\n        apiInstance.sendTransacEmail(sendSmtpEmail)\n        .then(() => {\n            return ({success: true, msg: 'Email sent'});       \n        })\n        .catch(err => {\n            return err;\n        })\n    })\n    .catch(err => {\n        return err;\n    }); \n}\n\n// submit aff application\nfunction sendAffApplicationSubmit (accountId, belongsTo, brand) {\n    AffPartner.findById(belongsTo)\n    .then(partner => {\n        User.findById(partner.belongsTo, {password: 0}).populate({ path: 'partner' })\n        .then(user => {\n            const { firstName, email } = user;\n\n            const apiInstance = new SibApiV3Sdk.SMTPApi();\n            let sendSmtpEmail = new SibApiV3Sdk.SendSmtpEmail();\n\n            sendSmtpEmail.sender = {\n                name: 'eWalletBooster',\n                email: 'support@ewalletbooster.com'\n            };\n            sendSmtpEmail.to = [{\n                email: email, \n                name: firstName\n            }];\n            sendSmtpEmail.replyTo = {email: 'support@ewalletbooster.com'};\n            sendSmtpEmail.templateId = 20;\n            sendSmtpEmail.tags = ['partner'];\n            sendSmtpEmail.params = {\n                FNAME: firstName,\n                ACCOUNTID: accountId,\n                BRAND: brand\n            }\n            apiInstance.sendTransacEmail(sendSmtpEmail)\n            .then(() => {\n                return ({success: true, msg: 'Email sent'});       \n            })\n            .catch(err => {\n                return err;\n            })\n        })\n        .catch(err => {\n            return err;\n        }); \n    })\n}\n\n// submit vip upgrade request\nfunction sendVIPRequestSubmit (accountId, belongsTo, brand) {\n    AffPartner.findById(belongsTo)\n    .then(partner => {\n        User.findById(partner.belongsTo, {password: 0}).populate({ path: 'partner' })\n        .then(user => {\n            const { firstName, email } = user;\n\n            const apiInstance = new SibApiV3Sdk.SMTPApi();\n            let sendSmtpEmail = new SibApiV3Sdk.SendSmtpEmail();\n\n            sendSmtpEmail.sender = {\n                name: 'eWalletBooster',\n                email: 'support@ewalletbooster.com'\n            };\n            sendSmtpEmail.to = [{\n                email: email, \n                name: firstName\n            }];\n            sendSmtpEmail.replyTo = {email: 'support@ewalletbooster.com'};\n            sendSmtpEmail.templateId = 21;\n            sendSmtpEmail.tags = ['partner'];\n            sendSmtpEmail.params = {\n                FNAME: firstName,\n                ACCOUNTID: accountId,\n                BRAND: brand\n            }\n            apiInstance.sendTransacEmail(sendSmtpEmail)\n            .then(() => {\n                return ({success: true, msg: 'Email sent'});       \n            })\n            .catch(err => {\n                return err;\n            })\n        })\n        .catch(err => {\n            return err;\n        }); \n    })\n}\n\n// submit payment request\nfunction sendAffPaymentRequest (_id, amount, currency) {\n    AffPartner.findById(_id)\n    .then(partner => {\n        User.findById(partner.belongsTo, { password: 0 }).populate({ path: 'partner' })\n        .then(user => {\n            const { firstName, email } = user;\n            amount = amount.toFixed(2);\n            const apiInstance = new SibApiV3Sdk.SMTPApi();\n            let sendSmtpEmail = new SibApiV3Sdk.SendSmtpEmail();\n\n            sendSmtpEmail.sender = {\n                name: 'eWalletBooster',\n                email: 'support@ewalletbooster.com'\n            };\n            sendSmtpEmail.to = [{\n                email: email, \n                name: firstName\n            }];\n            sendSmtpEmail.replyTo = {email: 'support@ewalletbooster.com'};\n            sendSmtpEmail.templateId = 23;\n            sendSmtpEmail.tags = ['partner'];\n            sendSmtpEmail.params = {\n                FNAME: firstName,\n                AMOUNT: amount,\n                CURRENCY: currency\n            }\n            apiInstance.sendTransacEmail(sendSmtpEmail)\n            .then(() => ({ success: true, msg: 'Email sent' })) \n            .catch(e => e)\n        }).catch(e => e)\n    })\n}\n\n// notify of account found from /affiliate-daily\nfunction sendAffAccountAdded(_id, accountId, brand) {\n    AffPartner.findById(_id)\n    .then(partner => {\n        User.findById(partner.belongsTo, {password: 0}).populate({ path: 'partner' })\n        .then(user => {\n            const { firstName, email } = user;\n            const apiInstance = new SibApiV3Sdk.SMTPApi();\n            let sendSmtpEmail = new SibApiV3Sdk.SendSmtpEmail();\n\n            sendSmtpEmail.sender = {\n                name: 'eWalletBooster',\n                email: 'support@ewalletbooster.com'\n            };\n            sendSmtpEmail.to = [{\n                email: email, \n                name: firstName\n            }];\n            sendSmtpEmail.replyTo = {email: 'support@ewalletbooster.com'};\n            sendSmtpEmail.templateId = 22;\n            sendSmtpEmail.tags = ['partner'];\n            sendSmtpEmail.params = {\n                FNAME: firstName,\n                ACCOUNTID: accountId,\n                BRAND: brand\n            }\n            apiInstance.sendTransacEmail(sendSmtpEmail)\n            .then(() => {\n                return ({success: true, msg: 'Email sent'});       \n            })\n            .catch(err => {\n                return err;\n            })\n        })\n        .catch(err => {\n            return err;\n        }); \n    })\n}\n\n// send aff application result\nfunction sendAffApplicationResult ({ belongsTo, accountId, brand }, action, reason) {\n    AffPartner.findById(belongsTo)\n    .then(partner => {\n        User.findById(partner.belongsTo, {password: 0}).populate({ path: 'partner' })\n        .then(user => {\n            const { firstName, email } = user;\n            const apiInstance = new SibApiV3Sdk.SMTPApi();\n            let sendSmtpEmail = new SibApiV3Sdk.SendSmtpEmail();\n\n            sendSmtpEmail.sender = {\n                name: 'eWalletBooster',\n                email: 'support@ewalletbooster.com'\n            };\n            sendSmtpEmail.to = [{\n                email: email, \n                name: firstName\n            }];\n\n            const template = action === 'upgraded' ? 24 : action === 'approved' ? 25 : 26;\n            \n            sendSmtpEmail.replyTo = {email: 'support@ewalletbooster.com'};\n            sendSmtpEmail.templateId = template;\n            sendSmtpEmail.tags = ['partner'];\n            sendSmtpEmail.params = {\n                FNAME: firstName,\n                ACCOUNTID: accountId,\n                BRAND: brand,\n                REASON: reason\n            }\n            apiInstance.sendTransacEmail(sendSmtpEmail)\n            .then(() => {\n                return ({success: true, msg: 'Email sent'});       \n            })\n            .catch(err => {\n                return err;\n            })\n        })\n        .catch(err => {\n            return err;\n        }); \n    })\n}\n\n// send payment confirmed \nfunction sendPaymentSent(_id, amount) {\n    AffPartner.findById(_id)\n    .then(partner => {\n        User.findById(partner.belongsTo, {password: 0}).populate({ path: 'partner' })\n        .then(user => {\n            const { firstName, email } = user;\n            const { paymentEmail, paymentBrand } = user.partner;\n            amount = amount.toFixed(2);\n            const apiInstance = new SibApiV3Sdk.SMTPApi();\n            let sendSmtpEmail = new SibApiV3Sdk.SendSmtpEmail();\n\n            sendSmtpEmail.sender = {\n                name: 'eWalletBooster',\n                email: 'support@ewalletbooster.com'\n            };\n            sendSmtpEmail.to = [{\n                email: email, \n                name: firstName\n            }];\n            sendSmtpEmail.replyTo = {email: 'support@ewalletbooster.com'};\n            sendSmtpEmail.templateId = 27;\n            sendSmtpEmail.tags = ['partner'];\n            sendSmtpEmail.params = {\n                FNAME: firstName,\n                AMOUNT: amount,\n                PAYMENTBRAND: paymentBrand,\n                PAYMENTEMAIL: paymentEmail\n            }\n            apiInstance.sendTransacEmail(sendSmtpEmail)\n            .then(() => {\n                return ({success: true, msg: 'Email sent'});       \n            })\n            .catch(err => {\n                return err;\n            })\n        })\n        .catch(err => {\n            return err;\n        }); \n    })\n}\n\n// send partner account disabled \nfunction sendPartnerDisabled (_id) {\n    User.findById(_id, { password: 0 })\n    .then(user => {\n        const { firstName, email } = user;\n        \n        const apiInstance = new SibApiV3Sdk.SMTPApi();\n        let sendSmtpEmail = new SibApiV3Sdk.SendSmtpEmail();\n\n        sendSmtpEmail.sender = {\n            name: 'eWalletBooster',\n            email: 'support@ewalletbooster.com'\n        };\n        sendSmtpEmail.to = [{\n            email: email, \n            name: firstName\n        }];\n        sendSmtpEmail.replyTo = { email: 'support@ewalletbooster.com' };\n        sendSmtpEmail.templateId = 29;\n        sendSmtpEmail.tags = ['partner'];\n        sendSmtpEmail.params = {\n            FNAME: firstName\n        }\n        apiInstance.sendTransacEmail(sendSmtpEmail)\n        .then(() => {\n            return ({success: true, msg: 'Email sent'});       \n        })\n        .catch(err => {\n            return err;\n        })\n    })\n    .catch(err => {\n        return err;\n    }); \n}\n\n// send ecoPayz request link\nfunction sendRequestEcoLink ( firstName, email ) {\n    const apiInstance = new SibApiV3Sdk.SMTPApi();\n    let sendSmtpEmail = new SibApiV3Sdk.SendSmtpEmail();\n    \n    sendSmtpEmail.sender = {\n        name: 'eWalletBooster',\n        email: 'support@ewalletbooster.com'\n    }\n    sendSmtpEmail.to = [\n        { email: email }, \n        { name: 'eWalletBooster', email: 'support@ewalletbooster.com' }\n    ];\n    sendSmtpEmail.replyTo = { email };\n    sendSmtpEmail.templateId = 44;\n    sendSmtpEmail.tags = ['partner'];\n    sendSmtpEmail.params = {\n        FNAME: firstName\n    }\n    apiInstance.sendTransacEmail(sendSmtpEmail)\n    .then(() => ({ success: true, msg: 'Email sent' })) \n    .catch(e => e)\n}\n\nfunction sendConfirmedEcoLink (email) {\n    const apiInstance = new SibApiV3Sdk.SMTPApi();\n    let sendSmtpEmail = new SibApiV3Sdk.SendSmtpEmail();\n    \n    sendSmtpEmail.sender = {\n        name: 'eWalletBooster',\n        email: 'support@ewalletbooster.com'\n    }\n    sendSmtpEmail.to = [\n        { email: email }\n    ];\n    sendSmtpEmail.replyTo = { email };\n    sendSmtpEmail.templateId = 45;\n    sendSmtpEmail.tags = ['partner'];\n    apiInstance.sendTransacEmail(sendSmtpEmail)\n    .then(() => ({ success: true, msg: 'Email sent' })) \n    .catch(e => e)\n}\n\nmodule.exports = {\n    sendApplicationSubmit,\n    sendApplicationSubmitSMS,\n    sendApplicationResult,\n    sendApplicationResultSMS,\n    sendApplicationLinked,\n    sendBonusStart,\n    sendPercentBonusStart,\n    sendBonusPayment,\n    sendMessage,\n    forgotPassSubmit,\n    sendFinalMonthlyStats,\n    sendFinalMonthlyStatsSMS,\n    sendMonthStatsOnFriday,\n    sendMonthStatsOnFridaySMS,\n    sendPayoutConfirm,\n    sendPaymentRequest,\n    sendWelcomeEmail,\n    createNewContact,\n    sendNewPartner,\n    sendUpdatedPaymentMethod,\n    sendAffApplicationSubmit,\n    sendVIPRequestSubmit,\n    sendAffPaymentRequest,\n    sendAffAccountAdded,\n    sendAffApplicationResult,\n    sendPaymentSent,\n    addPartnerToList,\n    sendPartnerDisabled,\n    addLightSignUpToList,\n    sendOfficialPartnerActivation,\n    sendSubPartnerActivation,\n    sendRequestEcoLink,\n    sendConfirmedEcoLink \n}\n\n// sendPayoutConfirm({\n//     \"_id\": {\n//         \"$oid\": \"5cf4e283a9a7df0004743a02\"\n//     },\n//     \"account\": {\n//         \"accountId\": \"452623321637\",\n//         \"deposits\": 0,\n//         \"transValue\": 9123.69,\n//         \"commission\": 27.37,\n//         \"cashback\": 21.49,\n//         \"cashbackRate\": \"0.24%\"\n//     },\n//     \"timestamp\": {\n//         \"$date\": \"2019-06-03T02:22:08.495Z\"\n//     },\n//     \"monthId\": \"June 2019\",\n//     \"periodId\": \"2019/06/01 - 2019/06/30\",\n//     \"brand\": \"Neteller\",\n//     \"status\": \"Pending\",\n//     \"lastUpdate\": \"July 1st 2019, 5:48:03 pm\",\n//     \"__v\": 0,\n//     \"belongsTo\": {\n//         \"$oid\": \"5be40dd24bc2800004028c99\"\n//     },\n//     \"belongsToUser\": \"5bcdcde930f3d20004cf440e\",\n//     \"paymentEmail\": \"paulmckenna191986@hotmail.co.uk\"\n// },{ isDeleted: false,\n//     _id: '5bcdcde930f3d20004cf440e',\n//     mobileNumber: '+447895008966',\n//     firstName: 'Paul',\n//     lastName: 'McKenna',\n//     email: 'mckennapaul27@gmail.com',\n//     SMS: true,\n//     __v: 0,\n//     resetPasswordExpires: null,\n//     resetPasswordToken: null })\n\n// sendPaymentRequest(\n//     {\n//         \"_id\": \"5c03ba44f9cbd10004e97f35\",\n//         \"status\": \"Requested\",\n//         \"month\": \"November 2018\",\n//         \"accountId\": \"457325584335\",\n//         \"belongsTo\": \"5be4102a2a2c160004409f18\",\n//         \"cashback\": 139.94,\n//         \"__v\": 0\n//     },\n//     'Paul',\n//     'mckennapaul27@gmail.com',\n//     'Neteller'\n// )\n// sendApplicationResultSMS({firstName: 'Paul', brand: 'Neteller', accountId: '450012345432', mobileNumber: '+447895008966'}, 'approved and upgraded to VIP')\n// sendApplicationResult(\"5d1a0ad2e1e1d47c300b5789\", 'approved and upgraded to VIP')\n// createApplicationLink ('5d135a27e78d6432ca2dd9e5')\n// createNewContact(\n//     { isDeleted: false,\n//     _id: '5bcdcde930f3d20004cf440e',\n//     mobileNumber: '+447895008366',\n//     firstName: 'Paul',\n//     lastName: 'McKenna',\n//     email: 'mckennapaul22227@gmail.com',\n//     SMS: true,\n//     __v: 0,\n//     resetPasswordExpires: null,\n//     resetPasswordToken: null }\n// )\n\n\n\n"]},"metadata":{},"sourceType":"script"}